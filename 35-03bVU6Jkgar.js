/*!CK:1308615592!*//*1412036147,*/

if (self.CavalryLogger) {
    CavalryLogger.start_js(["ghErm"]);
}

__d("SpotlightViewerLoggingEvents", [], function (a, b, c, d, e, f) {
    e.exports = {LOADED: "loaded", LOADING: "loading", ERROR: "error", ABORT: "abort", OPEN_BEGIN: "open_begin", OPEN_COMPLETE: "open_complete", CLOSE_BEGIN: "close_begin", CLOSE_COMPLETE: "close_complete", PAGE_BEGIN: "page_begin", PAGE_COMPLETE: "page_complete", PHOTO_CHANGE_BEGIN: "photo_change_begin", PHOTO_CHANGE_COMPLETE: "photo_change_complete", DATA_FETCH_BEGIN: "data_fetch_begin", DATA_FETCH_COMPLETE: "data_fetch_complete", PHOTO_FETCH: "photo_fetch"};
}, null);
__d("VideoPlayerLoggerEvents", [], function (a, b, c, d, e, f) {
    e.exports = {AUTOPLAY_PREFERENCE_CHANGED: "autoplay_preference_changed", END_STALL_TIME: "end_stall_time", AUTOPLAY_PREFERENCE_STATUS: "autoplay_preference_status", NOT_AUTOPLAYING: "not_autoplaying", VIDEO_ORIENTATION_CHANGED: "video_orientation_changed", ASSETS_LOADED: "assets_loaded", BUFFERED: "buffered", CANCELLED_REQUESTED_PLAYING: "cancelled_requested_playing", CAROUSEL_CHANGE: "carousel_change", DISPLAYED: "displayed", ENTERED_HD: "entered_hd", ENTERED_FALLBACK: "entered_fallback", ENTERED_FS: "entered_fs", EXITED_HD: "exited_hd", EXITED_FS: "exited_fs", ERROR: "error", FINISHED_PLAYING: "finished_playing", IMPRESSION: "impression", INVALID_URL: "invalid_url", MUTED: "muted", PAUSED: "paused", PLAY_REQUESTED: "play_requested", PLAYER_LOADED: "player_loaded", PROGRESS: "progress", READY_TO_PLAY: "ready_to_play", REPLAYED: "replayed", REQUESTED: "requested", REQUESTED_PLAYING: "requested_playing", SCRUBBED: "scrubbed", STARTED_PLAYING: "started_playing", STARTED_RECEIVING_BYTES: "started_receiving_bytes", STATS: "stats", STOPPED_PLAYING: "stopped_playing", UNMUTED: "unmuted", UNPAUSED: "unpaused", VOLUME_CHANGED: "volume_changed", VOLUME_DECREASE: "volume_decrease", VOLUME_INCREASE: "volume_increase", ENTER_LARGE_FORMAT: "enter_large_format", COMPLETION: "completion", VIEW: "view"};
}, null);
__d("VideoPlayerLoggerSources", [], function (a, b, c, d, e, f) {
    e.exports = {ADS: "ads", BROADCAST_REQUEST_ATTACHMENT: "broadcast_request_attachment", EMBEDDED: "embedded", HTML5: "html5", INLINE: "inline", CHAINED: "chained", INSIGHTS: "insights", LOOKBACK: "lookback", MISC: "misc", MOBILE: "mobile", PAGES_FINCH_MAIN_VIDEO: "pages_finch_main_video", PAGES_FINCH_THUMBNAIL_VIDEO: "pages_finch_thumbnail_video", PAGES_FINCH_TRAILER: "pages_finch_trailer", PAGES_VIDEO_SET: "pages_video_set", PERMALINK: "permalink", REPORT_FLOW: "report_flow", SNOWLIFT: "snowlift", TRAILER_LANDING_PAGE: "trailer_previews_landing_page", TRAILER_OG_ATTACHMENT: "trailer_og_attachment", TRAILER_TIMELINE_COLLECTIONS: "trailer_timeline_collections", TRAILER_TIMELINE_UNIT: "trailer_timeline_unit"};
}, null);
__d("VideoPlayerReason", [], function (a, b, c, d, e, f) {
    e.exports = {AUTOPLAY: "autoplay_initiated", USER: "user_initiated", PAGE_VISIBILITY: "page_visibility_initiated"};
}, null);
__d("VideoPlayerVersions", [], function (a, b, c, d, e, f) {
    e.exports = {CASABLANCA: "casablanca", HTML5: "html5", SILVERCITY: "silvercity"};
}, null);
__d("XUIGlyphConstants", [], function (a, b, c, d, e, f) {
    e.exports = {TWO_DOTS: "2-dots", THREE_DOTS: "3-dots", ACQUAINTANCES: "acquaintances", ADD_FRIEND: "add-friend", ALBUM: "album", APP: "app", ARROW_DOWN: "arrow-down", ARROW_LEFT: "arrow-left", ARROW_RIGHT: "arrow-right", ARROW_UP: "arrow-up", ATTACHMENT: "attachment", BAR_CHART: "bar-chart", BLOCK: "block", BOOK: "book", BOOKMARKS: "bookmarks", CAKE: "cake", CALL: "call", CAMERA: "camera", CHECKMARK: "checkmark", CHEVRON_DOWN: "chevron-down", CHEVRON_LEFT: "chevron-left", CHEVRON_RIGHT: "chevron-right", CHEVRON_UP: "chevron-up", CITY: "city", CLOCK: "clock", CLOSE_FRIENDS: "close-friends", COMMENT: "comment", COMPOSE: "compose", CONSTRAIN: "constrain", CROP: "crop", CROSS: "cross", CURSOR_ARROW: "cursor-arrow", DESKTOP: "desktop", DIRECTIONS: "directions", DOUBLE_TRIANGLE_H: "double-triangle-h", DOUBLE_TRIANGLE_V: "double-triangle-v", EDIT: "edit", ENVELOPE: "envelope", ERROR_SOLID: "error-solid", ERROR: "error", EVENTS: "events", FACEBOOK: "facebook", FEMALE: "female", FILTER: "filter", FITNESS: "fitness", FLASH: "flash", FORWARD: "forward", FRIEND_ADDED: "friend-added", FRIEND_REQUEST: "friend-request", FRIENDS_OF_FRIENDS: "friends-of-friends", FULLSCREEN: "fullscreen", GAMES: "games", GRID: "grid", GROUP: "group", HELP_SOLID: "help-solid", HELP: "help", HOME: "home", INFO_SOLID: "info-solid", INFORMATION: "information", JOINED_EVENT: "joined-event", JOINED_GROUP: "joined-group", KEYBOARD: "keyboard", LAPTOP: "laptop", LEAVE: "leave", LIKE: "like", LIST_GLYPH: "list", LOADING: "loading", LOCATION: "location", LOCK: "lock", LOVE: "love", MALE: "male", MESSAGES: "messages", MOVIE: "movie", MUSIC: "music", NETWORK: "network", NEWSFEED: "newsfeed", NOTES: "notes", NOTIFICATIONS: "notifications", PAGES: "pages", PHONE: "phone", PHOTOS: "photos", PIE_CHART: "pie-chart", PIN: "pin", PLACE: "place", PLUS: "plus", POKE: "poke", REFRESH_LEFT: "refresh-left", REFRESH_RIGHT: "refresh-right", REPLY: "reply", RESIZE_BIG: "resize-big", RESIZE_FREE: "resize-free", RESIZE_SMALL: "resize-small", RESTAURANT: "restaurant", ROTATE: "rotate", RSS: "rss", SCHOOL: "school", SEARCH: "search", SETTINGS: "settings", SHARE: "share", SIMPLE_PHOTOS: "simple-photos", STOP: "stop", SUBSCRIPTIONS: "subscriptions", TABLET: "tablet", TAG: "tag", TICKETS: "tickets", TRIANGLE_DOWN: "triangle-down", TRIANGLE_LEFT: "triangle-left", TRIANGLE_RIGHT: "triangle-right", TRIANGLE_UP: "triangle-up", TV: "tv", VIDEO: "video", VOLUME: "volume", WEB_SEARCH: "web-search", WI_FI: "wi-fi", WORK: "work", WWW: "www"};
}, null);
__d("ImageUtils", ["UserAgent_DEPRECATED"], function (a, b, c, d, e, f, g) {
    var h = {hasLoaded: function (i) {
        if (i.naturalWidth !== undefined) {
            return i.complete && i.width !== 0;
        } else if (i.height == 20 && i.width == 20 && i.complete) {
            return false;
        } else if (i.complete === undefined && g.webkit() < 500) {
            var j = new Image();
            j.src = i.src;
            return j.complete;
        }
        return i.complete;
    }};
    e.exports = h;
}, null);
__d("PhotoEverstoreLogger", ["Event", "AsyncRequest", "copyProperties", "ImageUtils"], function (a, b, c, d, e, f, g, h, i, j) {
    var k = {BATCH_WINDOW_MS: 500, storedLog: []};

    function l() {
    }

    i(l, {_log: function (n) {
        k.storedLog.push(n);
        if (k.storedLog.length == 1)setTimeout(m, k.BATCH_WINDOW_MS);
    }, logImmediately: function (n) {
        l._log(n);
    }, registerForLogging: function (n) {
        var o = document.getElementById(n);
        if (o != null)if (j.hasLoaded(o)) {
            l._log(o.src);
        } else g.listen(o, 'load', function (event) {
            l._log(o.src);
        });
    }});
    function m() {
        var n = k.storedLog;
        k.storedLog = [];
        var o = JSON.stringify(n);
        new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls: o}).setMethod('POST').setOption('suppressErrorHandlerWarning', true).setOption('suppressErrorAlerts', true).send();
    }

    e.exports = l;
}, null);
__d("PhotoViewerImage", ["PhotoEverstoreLogger", "URI", "Vector"], function (a, b, c, d, e, f, g, h, i) {
    function j(k) {
        "use strict";
        this._hiResDimensions = k.hiResDimensions && i.deserialize(k.hiResDimensions);
        this._normalDimensions = k.normalDimensions && i.deserialize(k.normalDimensions);
        this._info = k.info;
        this._video = k.video;
        this._shouldLog = k.everstoreLogThis;
        this._hiResSrc = k.hiResSrc;
        this._normalSrc = k.normalSrc;
        this._thumbSrc = k.thumbSrc;
        this._isInverted = false;
        this._data = k;
    }

    j.prototype.getURIString = function () {
        "use strict";
        return h(this._info.permalink).getUnqualifiedURI().toString();
    };
    j.prototype.hasHiResDimensions = function () {
        "use strict";
        return !!this._hiResDimensions;
    };
    j.prototype.getHiResDimensions = function () {
        "use strict";
        return this._hiResDimensions;
    };
    j.prototype.getNormalDimensions = function () {
        "use strict";
        return this._normalDimensions;
    };
    j.prototype.getHiResSrc = function () {
        "use strict";
        return this._hiResSrc;
    };
    j.prototype.getNormalSrc = function () {
        "use strict";
        return this._normalSrc;
    };
    j.prototype.getThumbSrc = function () {
        "use strict";
        return this._thumbSrc;
    };
    j.prototype.getInfo = function () {
        "use strict";
        return this._info;
    };
    j.prototype.getPermalink = function () {
        "use strict";
        return this._info.permalink;
    };
    j.prototype.getHighestResSrc = function () {
        "use strict";
        return this._hiResSrc || this._normalSrc;
    };
    j.prototype.preload = function (k) {
        "use strict";
        var l;
        if (this.getHighestResSrc())if (k && !this._resource) {
            this._resource = new Image();
            this._resource.src = this.getHighestResSrc();
            l = this._resource.src;
            if (this._shouldLog)g.logImmediately(this._resource.src);
        } else if (!k && !this._small) {
            this._small = new Image();
            this._small.src = this._normalSrc || this._hiResSrc;
            l = this._small.src;
            if (this._shouldLog)g.logImmediately(this._small.src);
        }
        return l;
    };
    j.prototype.setNormalDimensions = function (k, l) {
        "use strict";
        this._normalDimensions = new i(k, l);
    };
    j.prototype.setHiResDimensions = function (k, l) {
        "use strict";
        this._hiResDimensions = new i(k, l);
    };
    j.prototype.invertDimensions = function () {
        "use strict";
        if (this.hasHiResDimensions())this._hiResDimensions = new i(this._hiResDimensions.y, this._hiResDimensions.x);
        this._normalDimensions = new i(this._normalDimensions.y, this._normalDimensions.x);
        this._isInverted = !this._isInverted;
    };
    j.prototype.copy = function () {
        "use strict";
        return new j(this._data);
    };
    e.exports = j;
}, null);
__d("PhotoStreamCache", ["DOM", "HTML", "PhotoEverstoreLogger", "PhotosConst", "PhotoViewerImage", "Rect", "UIPagelet", "URI", "Vector", "copyProperties", "createArrayFrom", "ge"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r) {
    function s() {
        "use strict";
    }

    s.prototype.init = function (t, u, v, w, x) {
        "use strict";
        this.version = t;
        this.pageletName = u;
        this.pageletRootID = v;
        this.tagSuggestionMode = x;
        this.bufferSize = s.BUFFER_SIZE;
        this.fullBucketSize = s.FULL_BUCKET_SIZE;
        this.initError = false;
        this.isActive = true;
        this.usesOpaqueCursor = false;
        this.usesNonCircularPhotoSet = false;
        this.reachedLeftEnd = false;
        this.reachedRightEnd = false;
        this.leftLock = false;
        this.rightLock = false;
        this.useAjaxPipe = true;
        this.logger = w;
        this.viewAsUser = null;
        this.reset();
    };
    s.prototype.setViewAs = function (t) {
        "use strict";
        this.viewAsUser = t;
    };
    s.prototype.isInViewAsMode = function () {
        "use strict";
        return !!this.viewAsUser;
    };
    s.prototype.getViewAsUserId = function () {
        "use strict";
        return this.viewAsUser;
    };
    s.prototype.getUsesOpaqueCursor = function () {
        "use strict";
        return this.usesOpaqueCursor;
    };
    s.prototype.isNonCircularPhotoSet = function () {
        "use strict";
        return this.usesNonCircularPhotoSet;
    };
    s.prototype.setReachedLeftEnd = function () {
        "use strict";
        this.reachedLeftEnd = true;
    };
    s.prototype.setReachedRightEnd = function () {
        "use strict";
        this.reachedRightEnd = true;
    };
    s.prototype.hasReachedLeftEnd = function () {
        "use strict";
        return this.reachedLeftEnd;
    };
    s.prototype.hasReachedRightEnd = function () {
        "use strict";
        return this.reachedRightEnd;
    };
    s.prototype.nonCircularPhotoSetCanPage = function (t) {
        "use strict";
        if (!this.isNonCircularPhotoSet())return true;
        if (t < 0)return this.getCursorPos() || !this.hasReachedLeftEnd();
        if (t > 0)return (this.getLength() - 1 != this.getCursorPos()) || !this.hasReachedRightEnd();
        return true;
    };
    s.prototype.setUseAjaxPipe = function (t) {
        "use strict";
        this.useAjaxPipe = t;
    };
    s.prototype.reset = function () {
        "use strict";
        this.cache = {image: {}, extra: {}, html: {}};
        this.fbidList = [];
        this.loaded = false;
        this.allLoaded = false;
        this.permalinkMap = {};
        this.position = 0;
        this.totalCount = null;
        this.firstCursor = null;
        this.firstCursorIndex = null;
        this.firstOpaqueCursor = null;
    };
    s.prototype.waitForInitData = function () {
        "use strict";
        this.fbidList.push(s.INIT_PLACEHOLDER);
    };
    s.prototype.destroy = function () {
        "use strict";
        this.reset();
        this.isActive = false;
    };
    s.prototype.isLoaded = function () {
        "use strict";
        return this.loaded;
    };
    s.prototype.canPage = function () {
        "use strict";
        if (!this.isLoaded())return false;
        if (this.totalCount !== null)return this.totalCount > 1;
        if (this.usesNonCircularPhotoSet)return true;
        return this.getLength() > 1;
    };
    s.prototype.errorInCurrent = function () {
        "use strict";
        if (this.initError) {
            return true;
        } else if (!this.isLoaded())return false;
        return this.checkErrorAt(this.getCursor());
    };
    s.prototype.getLength = function () {
        "use strict";
        return this.fbidList.length;
    };
    s.prototype.getPhotoSet = function () {
        "use strict";
        return this.photoSetQuery.set;
    };
    s.prototype.getPhotoSetQuery = function () {
        "use strict";
        return this.photoSetQuery;
    };
    s.prototype.getCurrentImageData = function () {
        "use strict";
        return this.getImageData(this.getCursor());
    };
    s.prototype.addViewAsToURI = function (t) {
        "use strict";
        var u = n(t);
        if (this.isInViewAsMode())u.addQueryData({viewas: this.getViewAsUserId()});
        return u;
    };
    s.prototype.getOpaqueCursor = function (t) {
        "use strict";
        if (this.getImageData(t)) {
            if (this.version === j.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;
            return this.getImageData(t).info.opaquecursor;
        }
        if (t == this.firstCursor)return this.firstOpaqueCursor;
        return null;
    };
    s.prototype.getImageData = function (t) {
        "use strict";
        var u = this.getCacheContent(t, s.IMAGE_DATA);
        if (u)u.info.permalink = this.addViewAsToURI(u.info.permalink);
        return u;
    };
    s.prototype.getCurrentHtml = function () {
        "use strict";
        return this.getCacheContent(this.getCursor(), s.HTML);
    };
    s.prototype.getCurrentExtraData = function () {
        "use strict";
        return this.getCacheContent(this.getCursor(), s.EXTRA);
    };
    s.prototype.getCacheContent = function (t, u) {
        "use strict";
        if (!t || t === s.ERROR_ID || t === s.INIT_PLACEHOLDER)return null;
        return this.cache[u][t];
    };
    s.prototype.getCursorPos = function () {
        "use strict";
        return this.position;
    };
    s.prototype.getCursor = function () {
        "use strict";
        if (this.position >= 0 && this.position < this.getLength())return this.fbidList[this.position];
        return null;
    };
    s.prototype.getCursorAt = function (t) {
        "use strict";
        return this.fbidList[t];
    };
    s.prototype.getCursorForURI = function (t) {
        "use strict";
        return this.permalinkMap[t];
    };
    s.prototype.calculatePositionForMovement = function (t) {
        "use strict";
        var u = this.position + t;
        if (this.allLoaded) {
            var v = this.getLength();
            u = (v + u % v) % v;
        }
        return u;
    };
    s.prototype.isValidMovement = function (t) {
        "use strict";
        if (!this.isLoaded() || !this.canPage())return false;
        var u = this.calculatePositionForMovement(t);
        return this.getCursor() > 0 || (u >= 0 && u < this.getLength());
    };
    s.prototype.moveCursor = function (t) {
        "use strict";
        if (!this.isValidMovement(t))return;
        this.position = this.calculatePositionForMovement(t);
        if (t !== 0)this.loadMoreIfNeccessary(t > 0);
    };
    s.prototype.checkErrorAt = function (t) {
        "use strict";
        if (!this.isLoaded())return false;
        if (t === s.ERROR_ID)return true;
        return false;
    };
    s.prototype.getRelativeMovement = function (t) {
        "use strict";
        for (var u = 0; u < this.getLength(); u++)if (this.fbidList[u] == t)return u - this.position;
        return null;
    };
    s.prototype.preloadImages = function (t) {
        "use strict";
        var u, v, w = this.getLength(), x = this.cache.image, y = s.BUFFER_SIZE;
        if (w > y * 2) {
            u = (this.position + w - y % w) % w;
            v = (this.position + y) % w;
        } else {
            u = 0;
            v = w - 1;
        }
        while (u != v) {
            var z, aa = this.fbidList[u], ba = t && t(x[aa]);
            if (this.version === j.VIEWER_VAULTBOX) {
                z = x[aa] && x[aa].preload(ba);
            } else if (x[aa] && x[aa].url)if (ba && !x[aa].resource) {
                x[aa].resource = new Image();
                x[aa].resource.src = x[aa].url;
                z = x[aa].url;
                if (x[aa].everstoreLogThis === true)i.logImmediately(x[aa].resource.src);
            } else if (!ba && !x[aa].small) {
                x[aa].small = new Image();
                x[aa].small.src = x[aa].smallurl || x[aa].url;
                z = x[aa].small.src;
                if (x[aa].everstoreLogThis === true)i.logImmediately(x[aa].small.src);
            }
            if (this.logger && z)this.logger.log(z);
            u = (u + 1) % w;
        }
    };
    s.prototype.loadMoreIfNeccessary = function (t) {
        "use strict";
        if (this.allLoaded || (t && this.rightLock) || (!t && this.leftLock))return;
        var u = t ? 1 : -1, v = this.position + this.bufferSize * u;
        if (v < 0 && !this.checkErrorAt(this.getEndCursor(false))) {
            this.leftLock = true;
            this.fetch(this.fullBucketSize, false);
        } else if (v > this.getLength() && !this.checkErrorAt(this.getEndCursor(true))) {
            this.rightLock = true;
            this.fetch(this.fullBucketSize, true);
        }
    };
    s.prototype.getEndCursor = function (t) {
        "use strict";
        return t ? this.fbidList[this.getLength() - 1] : this.fbidList[0];
    };
    s.prototype.calculateRelativeIndex = function (t, u, v) {
        "use strict";
        if (!this.totalCount)return null;
        var w = this.fbidList.indexOf(u), x = this.fbidList.indexOf(v);
        if (w === -1 || x === -1)return null;
        var y = x - w;
        return (t + y + this.totalCount) % this.totalCount;
    };
    s.prototype.calculateDistance = function (t, u) {
        "use strict";
        var v = this.fbidList.indexOf(t), w = this.fbidList.indexOf(u);
        if (v === -1 || w === -1)return null;
        return (w - v + this.getLength()) % this.getLength();
    };
    s.prototype.fetch = function (t, u) {
        "use strict";
        var v = this.getEndCursor(u), w = p({cursor: v, version: this.version, end: this.getEndCursor(!u), fetchSize: u ? t : -1 * t, relevant_count: this.relevantCount, opaqueCursor: this.getOpaqueCursor(v), tagSuggestionMode: this.tagSuggestionMode}, this.photoSetQuery);
        if (this.isInViewAsMode())w.viewas = this.getViewAsUserId();
        if (this.totalCount && this.firstCursorIndex !== null) {
            w.total = this.totalCount;
            w.cursorIndex = this.calculateRelativeIndex(this.firstCursorIndex, this.firstCursor, v);
        }
        var x = r(this.pageletRootID);
        if (!x) {
            x = g.create('div', {id: this.pageletRootID});
            g.appendContent(document.body, x);
        }
        m.loadFromEndpoint(this.pageletName, x, w, {usePipe: this.useAjaxPipe, automatic: true, jsNonblock: true, crossPage: true});
        if (!this.useAjaxPipe)this.setUseAjaxPipe(true);
    };
    s.prototype.storeToCache = function (t) {
        "use strict";
        var u = {};
        if (!this.isActive)return u;
        if ('error' in t) {
            this.processErrorResult(t.error);
            u.error = true;
            return u;
        }
        if ('init' in t) {
            this.processInitResult(t.init);
            u.init = {logids: t.init.logids, fbid: t.init.fbid, loggedin: t.init.loggedin, fromad: t.init.fromad};
        }
        if ('image' in t) {
            this.processImageResult(t.image);
            u.image = true;
        }
        if ('data' in t) {
            this.processDataResult(t.data);
            u.data = true;
        }
        return u;
    };
    s.prototype.processInitResult = function (t) {
        "use strict";
        if (this.loaded)return;
        this.usesOpaqueCursor = t.usesopaquecursor;
        this.usesNonCircularPhotoSet = t.isnoncircularphotoset;
        this.loaded = true;
        this.photoSetQuery = t.query;
        if (t.bufferSize)this.bufferSize = t.bufferSize;
        if (t.fullBucketSize)this.fullBucketSize = t.fullBucketSize;
        if (this.fbidList.length === 0) {
            this.fbidList.push(t.fbid);
            this.rightLock = true;
        } else {
            var u = this.fbidList.indexOf(s.INIT_PLACEHOLDER);
            if (u != -1)this.fbidList[u] = t.fbid;
        }
        this.firstCursor = t.fbid;
        this.firstOpaqueCursor = t.opaquecursor;
        if ('initIndex' in t && 'totalCount' in t) {
            this.firstCursorIndex = t.initIndex;
            this.totalCount = t.totalCount;
        }
        if (this.version == j.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE, true);
    };
    s.prototype.processImageResult = function (t) {
        "use strict";
        for (var u in t) {
            if (u === this.firstCursor && t[u].everstoreLogThis)i.logImmediately(t[u].url);
            if (this.version === j.VIEWER_VAULTBOX) {
                var v = t[u];
                this.cache.image[u] = new k(v);
                this.permalinkMap[this.cache.image[u].getURIString()] = u;
            } else {
                this.cache.image[u] = t[u];
                if (t[u].dimensions)this.cache.image[u].dimensions = o.deserialize(t[u].dimensions);
                if (t[u].originalDimensions)this.cache.image[u].originalDimensions = o.deserialize(t[u].originalDimensions);
                if (t[u].smalldims)this.cache.image[u].smalldims = o.deserialize(t[u].smalldims);
                this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()] = u;
            }
        }
    };
    s.prototype.attachToFbidsList = function (t, u, v) {
        "use strict";
        if (this.allLoaded)return;
        if (u === -1) {
            for (var w = t.length - 1; w >= 0; w--) {
                this.fbidList.unshift(t[w]);
                this.position++;
            }
            this.leftLock = false;
        } else {
            for (var x = 0; x < t.length; x++)this.fbidList.push(t[x]);
            this.rightLock = false;
        }
        if (v)this.setAllLoaded();
    };
    s.prototype.setAllLoaded = function () {
        "use strict";
        this.allLoaded = true;
        if (this.getCursor() === null)this.position = this.calculatePositionForMovement(0);
    };
    s.prototype.processDataResult = function (t) {
        "use strict";
        for (var u in t) {
            if (!this.cache.html[u])this.cache.html[u] = {};
            for (var v in t[u].html) {
                var w = t[u].html[v];
                if (typeof w === 'string')w = h(w).getRootNode();
                this.cache.html[u][v] = q(w.childNodes);
            }
            if (!('extra' in t[u])) {
                this.cache.extra[u] = null;
                continue;
            }
            this.cache.extra[u] = {tagRects: {}};
            if (!Array.isArray(t[u].extra.tagRects))for (var x in t[u].extra.tagRects)if (t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x] = l.deserialize(t[u].extra.tagRects[x]);
            Object.keys(t[u].extra).forEach(function (y) {
                if (y == 'tagRects')return;
                this.cache.extra[u][y] = t[u].extra[y];
            }.bind(this));
        }
    };
    s.prototype.processErrorResult = function (t) {
        "use strict";
        if (!this.isLoaded()) {
            this.initError = true;
            return;
        }
        var u = t.side, v = [s.ERROR_ID];
        this.attachToFbidsList(v, u);
    };
    s.prototype.setTotalCount = function (t) {
        "use strict";
        this.totalCount = t;
    };
    s.prototype.setFirstCursorIndex = function (t) {
        "use strict";
        this.firstCursorIndex = t;
    };
    p(s, {ERROR: 'error', HTML: 'html', IMAGE_DATA: 'image', EXTRA: 'extra', BUFFER_SIZE: 3, INIT_BUCKET_SIZE: 4, FULL_BUCKET_SIZE: 12, ERROR_ID: -1, INIT_PLACEHOLDER: 1});
    e.exports = s;
}, null);
__d("XPhotosetSearchPivotControllerURIBuilder", ["XControllerURIBuilder"], function (a, b, c, d, e, f) {
    e.exports = b("XControllerURIBuilder").create("\/search-pivot\/photoset\/", {fbid: {type: "Int", required: true}, tags: {type: "IntToIntMap"}});
}, null);
__d("PhotosetSearchPivotData", ["AsyncRequest", "Deferred", "PhotoStreamCache", "XPhotosetSearchPivotControllerURIBuilder"], function (a, b, c, d, e, f, g, h, i, j) {
    var k = /^(perm:)?tag:(\d+)/, l = {}, m = {fetch: function (n, o) {
        if (!(n in l)) {
            var p = l[n] = new h(), q = (new j()).setInt('fbid', n);
            if (o) {
                var r = {};
                o.fbidList.forEach(function (t) {
                    var u = o.getCacheContent(t, i.EXTRA);
                    if (u)Object.keys(u.tagRects).forEach(function (v) {
                        if (k.test(v)) {
                            var w = RegExp.$2;
                            if (w in r) {
                                r[w]++;
                            } else r[w] = 1;
                        }
                    });
                });
                q.setIntToIntMap('tags', r);
            }
            (new g()).setURI(q.getURI()).setHandler(function (t) {
                p.succeed(t.getPayload());
            }).setErrorHandler(function (t) {
                return p.fail(t);
            }).setAllowCrossPageTransition(true).send();
        }
        var s = new h();
        l[n].addCallback(function (t) {
            return s.succeed(t);
        });
        l[n].addErrback(function (t) {
            delete l[n];
            s.fail(t);
        });
        return s;
    }};
    e.exports = m;
}, null);
__d("XUIGlyph.react", ["React", "XUIGlyphConstants", "getObjectValues", "merge"], function (a, b, c, d, e, f, g, h, i, j) {
    var k = g.PropTypes, l = g.createClass({displayName: 'XUIGlyph', propTypes: {image: k.oneOf(i(h)).isRequired, shade: k.oneOf(['light', 'dark', 'white', 'accent']), size: k.oneOf(['small', 'medium', 'large'])}, getDefaultProps: function () {
        return {size: 'small', shade: 'dark'};
    }, render: function () {
        var m = '/images/mobile/glyph/' + this.props.image;
        m += '_' + l.shadeToFileName[this.props.shade];
        m += '_' + l.sizeToFileName[this.props.size];
        m += '.png';
        return g.createElement(g.DOM.img, Object.assign({}, this.props, {src: m}));
    }, statics: j(h, {sizeToFileName: {small: 's', medium: 'm', large: 'l'}, shadeToFileName: {light: 'light-grey', dark: 'dark-grey', white: 'white', accent: 'blue'}})});
    e.exports = l;
}, null);
__d("ManagedError", [], function (a, b, c, d, e, f) {
    function g(h, i) {
        Error.prototype.constructor.call(this, h);
        this.message = h;
        this.innerError = i;
    }

    g.prototype = new Error();
    g.prototype.constructor = g;
    e.exports = g;
}, null);
__d("HVideoPlayerMixin", ["EventListener", "VideoPlayerLoggerEvents", "VideoPlayerVersions"], function (a, b, c, d, e, f, g, h, i) {
    var j = -1, k = {initLogger: function (l) {
        var m = this.getSubscriptions();
        this._loggedEvents = {};
        this._logFunction = l;
        var n = this.getVideoElement();
        this._lastStartTimePosition = j;
        this._muted = n.muted;
        this._pausedPosition = j;
        this._seeking = false;
        this._seekSourceTimePosition = j;
        this._volume = n.volume;
        this._lastPlayedTime = j;
        if (n.readyState >= n.HAVE_FUTURE_DATA) {
            this._logReadyToPlay();
        } else m.addSubscriptions(g.listen(n, 'canplay', this._logReadyToPlay.bind(this)));
        m.addSubscriptions(g.listen(n, 'pause', this._onPause.bind(this)), g.listen(n, 'playing', this._onPlay.bind(this)), g.listen(n, 'seeked', this._onSeeked.bind(this)), g.listen(n, 'seeking', this._onSeeking.bind(this)), g.listen(n, 'timeupdate', this._onTimeUpdate.bind(this)), g.listen(n, 'volumechange', this._onVolumeChange.bind(this)));
    }, _logOnce: function (event, l) {
        if (this._loggedEvents[event])return;
        this._logEvent(event, l);
    }, _logEvent: function (event, l) {
        this._loggedEvents[event] = true;
        var m = l ? l : {};
        m.video_id = this.getVideoID();
        m.player_version = i.HTML5;
        if (!m.hasOwnProperty('video_time_position'))m.video_time_position = this.getVideoElement().currentTime;
        m.time = Math.round(Date.now() / 1000);
        if (this.getAdClientToken) {
            var n = this.getAdClientToken();
            if (n)m.ad_client_token = n;
        }
        this._logFunction(event, m);
    }, _logReadyToPlay: function () {
        this._logOnce(h.READY_TO_PLAY);
    }, _onPause: function () {
        var l = this.getVideoElement(), event = l.ended ? h.FINISHED_PLAYING : h.PAUSED;
        this._logEvent(event, {video_last_start_time_position: this._lastStartTimePosition, video_time_position: this._lastPlayedTime});
        this._lastStartTimePosition = j;
    }, getLastStartTimePosition: function () {
        return this._lastStartTimePosition;
    }, _onPlay: function () {
        var event = this._loggedEvents[h.STARTED_PLAYING] ? h.UNPAUSED : h.STARTED_PLAYING;
        this._logEvent(event);
        this._lastStartTimePosition = this.getVideoElement().currentTime.toFixed(2);
    }, _onSeeked: function () {
        var l = {video_seek_source_time_position: this._seekSourceTimePosition};
        if (this._lastStartTimePosition !== j) {
            l.video_last_start_time_position = this._lastStartTimePosition;
        } else l.video_last_start_time_position = this._seekSourceTimePosition;
        this._logEvent(h.SCRUBBED, l);
        var m = this.getVideoElement();
        if (m.paused) {
            this._lastStartTimePosition = j;
        } else this._lastStartTimePosition = m.currentTime;
        this._seekSourceTimePosition = j;
        this._seeking = false;
    }, _onSeeking: function () {
        if (!this._seeking) {
            this._seekSourceTimePosition = this.getVideoElement().currentTime.toFixed(2);
            this._seeking = true;
        }
    }, _onTimeUpdate: function () {
        var l = this.getVideoElement();
        if (!l.paused)this._lastPlayedTime = l.currentTime.toFixed(2);
    }, _onVolumeChange: function () {
        var l = this.getVideoElement(), m = {}, event = null;
        if (l.muted !== this._muted && l.volume === this._volume && l.volume > 0) {
            event = l.muted ? h.MUTED : h.UNMUTED;
        } else {
            event = l.volume > this._volume ? h.VOLUME_INCREASE : h.VOLUME_DECREASE;
            m.current_volume = l.volume;
        }
        this._logEvent(event);
        this._muted = l.muted;
        this._volume = l.volume;
    }};
    e.exports = k;
}, null);
__d("VideoPlayerLoggerErrors", [], function (a, b, c, d, e, f) {
    e.exports = {ENTERED_FALLBACK: 'entered_fallback', ERROR_CALLING_FLASH: 'error_calling_flash'};
}, null);
__d("VideoPlayerLoggerErrorStates", [], function (a, b, c, d, e, f) {
    e.exports = {PLAYBACK_FAILURE: 'playback_failure', PLAYER_FAILURE: 'player_failure'};
}, null);
__d("VideoPlayerLoggerFallbackReasons", [], function (a, b, c, d, e, f) {
    e.exports = {TIMEOUT: 'timeout', FLASH_ERROR: 'flash_error', FLASH_UNAVAILABLE: 'flash_unavailable'};
}, null);
__d("VideoPlayerLoggerPlayerStates", [], function (a, b, c, d, e, f) {
    e.exports = {STARTED: 'started', UNPAUSED: 'unpaused'};
}, null);
__d("VideoPlayerLogger", ["Banzai", "ErrorUtils", "TimeSpentImmediateActiveSecondsLogger", "VideoPlayerLoggerEvents", "VideoPlayerLoggerErrors", "VideoPlayerLoggerErrorStates", "VideoPlayerLoggerFallbackReasons", "VideoPlayerLoggerSources", "VideoPlayerLoggerPlayerStates", "copyProperties", "ex"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q) {
    var r = 'video_player';

    function s(t, u) {
        "use strict";
        this.$VideoPlayerLogger0 = t;
        this.$VideoPlayerLogger1 = null;
        this.$VideoPlayerLogger2 = {};
        this.$VideoPlayerLogger3 = u;
        this.$VideoPlayerLogger4();
    }

    s.prototype.logEvent = function (event, t) {
        "use strict";
        p(t, this.$VideoPlayerLogger3);
        if (this.$VideoPlayerLogger2.hasOwnProperty(event)) {
            t.initial_event = false;
        } else t.initial_event = this.$VideoPlayerLogger2[event] = true;
        if (!t.hasOwnProperty('time'))t.time = Math.round(Date.now() / 1000);
        t.time_ms = Date.now();
        if (this.$VideoPlayerLogger1)p(t, this.$VideoPlayerLogger1);
        switch (event) {
            case j.REQUESTED_PLAYING:
                this.$VideoPlayerLogger4();
                this.$VideoPlayerLogger5();
                this.$VideoPlayerLogger6 = true;
                if (this.$VideoPlayerLogger2[j.STARTED_PLAYING]) {
                    t.state = o.UNPAUSED;
                } else t.state = o.STARTED;
                break;
            case j.STARTED_PLAYING:
            case j.UNPAUSED:
            case j.FINISHED_PLAYING:
            case j.CANCELLED_REQUESTED_PLAYING:
            case j.ERROR:
            case j.PAUSED:
                if (event === j.ERROR && t.state !== l.PLAYBACK_FAILURE)break;
                if (event === j.CANCELLED_REQUESTED_PLAYING)if (this.$VideoPlayerLogger2[j.STARTED_PLAYING]) {
                    t.state = o.UNPAUSED;
                } else t.state = o.STARTED;
                if (this.$VideoPlayerLogger6)this.$VideoPlayerLogger7();
                this.$VideoPlayerLogger8(t);
                this.$VideoPlayerLogger4();
                break;
        }
        var u = {logData: t, event: event, scriptPath: this.$VideoPlayerLogger9, source: this.$VideoPlayerLogger0};
        if (!event)h.reportError(new Error(q('VideoPlayerLogger: Missing event name')), false);
        if (t.ad_client_token) {
            g.post(r, u, g.VITAL);
        } else g.post(r, u);
        if (event === j.FINISHED_PLAYING || event === j.PAUSED) {
            var v = t.time_ms || Date.now(), w = t.video_time_position - t.video_last_start_time_position;
            if (w >= 0)i.maybeReportActiveInterval('video', v - Math.floor(w * 1000), v);
        }
    };
    s.prototype.setScriptPath = function (t) {
        "use strict";
        this.$VideoPlayerLogger9 = t;
    };
    s.prototype.setFTData = function (t) {
        "use strict";
        this.$VideoPlayerLogger1 = t;
    };
    s.prototype.startBuffering = function () {
        "use strict";
        this.$VideoPlayerLogger5();
    };
    s.prototype.endBuffering = function () {
        "use strict";
        if (this.$VideoPlayerLoggera > 0)this.$VideoPlayerLogger7();
    };
    s.prototype.$VideoPlayerLogger5 = function () {
        "use strict";
        this.$VideoPlayerLoggera = Date.now();
    };
    s.prototype.$VideoPlayerLogger7 = function () {
        "use strict";
        this.$VideoPlayerLoggerb = this.$VideoPlayerLoggerb + (Date.now() - this.$VideoPlayerLoggera);
        this.$VideoPlayerLoggerc++;
    };
    s.prototype.$VideoPlayerLogger8 = function (t) {
        "use strict";
        if (t.player_version === 'silvercity') {
            t.stall_time = Math.max(0, this.$VideoPlayerLoggerb);
            t.stall_count = this.$VideoPlayerLoggerc;
        }
    };
    s.prototype.$VideoPlayerLogger4 = function () {
        "use strict";
        this.$VideoPlayerLoggerb = 0;
        this.$VideoPlayerLoggera = 0;
        this.$VideoPlayerLoggerc = 0;
        this.$VideoPlayerLogger6 = false;
    };
    p(s, {Sources: n, Errors: k, FallbackReasons: m, ErrorStates: l, PlayerStates: o});
    e.exports = s;
}, null);
__d("PhotoLogger", ["Event", "BanzaiScuba", "SpotlightViewerLoggingEvents", "SubscriptionsHandler"], function (a, b, c, d, e, f, g, h, i, j) {
    function k(l) {
        "use strict";
        this.$PhotoLogger0 = l;
        this.$PhotoLogger1 = {};
    }

    k.prototype.log = function (l) {
        "use strict";
        if (!this.$PhotoLogger1[l]) {
            this.$PhotoLogger2(l);
            this.$PhotoLogger1[l] = true;
        }
    };
    k.prototype.$PhotoLogger2 = function (l) {
        "use strict";
        this.$PhotoLogger3(i.LOADING, {uri: l});
        var m = new j(), n = new Image();
        m.addSubscriptions(g.listen(n, 'load', function () {
            this.$PhotoLogger3(i.LOADED, {uri: l});
            m.release();
        }.bind(this)), g.listen(n, 'error', function () {
            this.$PhotoLogger3(i.ERROR, {uri: l});
            m.release();
        }.bind(this)), g.listen(n, 'abort', function () {
            this.$PhotoLogger3(i.ABORT, {uri: l});
            m.release();
        }.bind(this)));
        n.src = l;
    };
    k.prototype.logEvent = function (l) {
        "use strict";
        this.$PhotoLogger3(l);
    };
    k.prototype.$PhotoLogger3 = function (l, m) {
        "use strict";
        var n = new h('photos_client_loading', null, {addBrowserFields: true});
        n.addNormal('event', l);
        n.addNormal('viewer', this.$PhotoLogger0);
        for (var o in m)n.addNormal(o, m[o]);
        n.post();
    };
    e.exports = k;
}, null);
__d("PhotoSessionLog", ["AsyncRequest", "Run", "Vector", "copyProperties"], function (a, b, c, d, e, f, g, h, i, j) {
    function k() {
    }

    j(k, {UNKNOWN: 0, ESC: 1, X: 2, OUTSIDE: 3, UNLOAD: 4, NAVIGATE: 5, AGGREGATE: 6, LEAVE: 7, PERMALINK: 0, SNOWLIFT: 6, SNOWDOWN: 13, AGGREGATION_COUNT: 20, set: null, time: null, views: 0, fbidList: [], details: {}, width: 0, height: 0, first: false, last: false, logIds: false, version: null, source: null, buttonLikes: 0, pagingAction: '', cycle: false, endOfRelevant: false, relevantCount: 0, initLogging: function (l) {
        this.set = null;
        this.time = new Date();
        this.views = 0;
        this.hiResLoads = 0;
        this.fullScreenViews = {};
        this.first = true;
        this.last = false;
        this.logIds = false;
        this.version = l;
        this.buttonLikes = 0;
        this.pagingAction = '';
        this.cycle = false;
        this.endOfRelevant = false;
        this.relevantCount = 0;
        this.panoramaClicks = 0;
        this.panoramaImpressions = 0;
        if (l === k.SNOWLIFT) {
            var m = i.getViewportDimensions();
            this.width = m.x;
            this.height = m.y;
        }
    }, setLogFbids: function (l) {
        this.logIds = l;
    }, setPhotoSet: function (l) {
        this.set = l;
    }, addButtonLike: function () {
        this.buttonLikes++;
    }, setPagingAction: function (l) {
        this.pagingAction = l;
    }, setCycle: function (l) {
        this.cycle = l;
    }, setEndOfRelevant: function (l) {
        this.endOfRelevant = l;
    }, setRelevantCount: function (l) {
        this.relevantCount = l;
    }, setEndMetrics: function (l) {
        this.endMetrics = l;
    }, setSource: function (l) {
        this.source = l;
    }, addPanoramaClick: function () {
        this.panoramaClicks++;
    }, addPanoramaImpression: function () {
        this.panoramaImpressions++;
    }, addPhotoView: function (l, m, n) {
        if (this.logIds && this.views >= this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);
        this.views++;
        if (l)this.fbidList.push([l.fbid, l.owner, Date.now()]);
        if (m)this.hiResLoads++;
        if (n)this.fullScreenViews[l.fbid] = true;
    }, logEnterFullScreen: function (l) {
        this.fullScreenViews[l] = true;
    }, addDetailData: function (l, m) {
        if (!this.details[l])this.details[l] = {t: m.num_tags, l: m.has_location, c: m.has_caption, cm: m.comment_count, lk: m.like_count, w: m.width, h: m.height, ad: '{}', p: this.pagingAction};
    }, updateAdData: function (l, m) {
        if (this.details[l])this.details[l].ad = JSON.stringify(m);
    }, logPhotoViews: function (l) {
        if (!this.views)return;
        if (l != this.AGGREGATE)this.last = true;
        var m = {set: this.set, time: new Date() - this.time, fbids: this.logIds ? this.fbidList : [], details: this.logIds ? this.details : {}, first: this.first, last: this.last, close: l ? l : this.UNKNOWN, button_likes: this.buttonLikes, version: this.version, endmetric: this.endMetrics, cycle: this.cycle, end_relev: this.endOfRelevant, relev_count: this.relevantCount, source: this.source, panorama_clicks: this.panoramaClicks, panorama_impressions: this.panoramaImpressions};
        if (this.version === k.SNOWLIFT) {
            var n = i.getViewportDimensions();
            m.width = n.x || this.width;
            m.height = n.y || this.height;
            if (this.hiResLoads > 0)m.hires_loads = this.hiResLoads;
            if (this.last) {
                var o = Object.keys(this.fullScreenViews).length;
                if (o > 0)m.fullscreen = o;
            }
        }
        new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous', (l != k.UNLOAD)).setOption('suppressErrorHandlerWarning', true).setData(m).send();
        this.views = 0;
        this.hiResLoads = 0;
        this.fbidList = [];
        this.details = {};
        this.first = false;
        this.buttonLikes = 0;
        if (this.last) {
            this.set = null;
            this.logIds = false;
            this.fullScreenViews = {};
        }
    }});
    h.onUnload(function () {
        k.logPhotoViews(k.UNLOAD);
    });
    h.onLeave(function () {
        k.logPhotoViews(k.LEAVE);
    });
    e.exports = k;
}, null);
__d("PhotosUtils", ["copyProperties", "Vector"], function (a, b, c, d, e, f, g, h) {
    function i() {
    }

    g(i, {getNearestBox: function (j, k) {
        var l = Infinity, m = null;
        for (var n in j) {
            var o = j[n];
            if (o.contains(k)) {
                var p = k.distanceTo(o.getCenter());
                if (p < l) {
                    l = p;
                    m = n;
                }
            }
        }
        return m;
    }, absoluteToNormalizedPosition: function (j, k) {
        var l = h.getElementPosition(j), m = h.getElementDimensions(j), n = k.sub(l).mul(100 / m.x, 100 / m.y);
        n.domain = 'pure';
        return n;
    }, normalizedToAbsolutePosition: function (j, k) {
        var l = h.getElementPosition(j), m = h.getElementDimensions(j), n = k.mul(m.x / 100, m.y / 100).add(l);
        n.domain = 'document';
        return n;
    }, isFacebox: function (j) {
        return j.match(/^face:/);
    }, isTag: function (j) {
        return j.match(/^tag:/);
    }});
    e.exports = i;
}, null);
__d("PhotoPermalinkURI", [], function (a, b, c, d, e, f) {
    var g = {isValid: function (h) {
        return g.parse(h) !== null;
    }, parse: function (h) {
        if (this.isValidLegacy(h)) {
            var i = h.getQueryData();
            if (i.fbid)return {photo_id: i.fbid, set_token: i.set};
            if (i.id && i.pid)return {photo_id: i.id + ':' + i.pid, set_token: i.set};
            return null;
        }
        var j = h.getPath();
        if (j[j.length - 1] === '/')j = j.substring(0, j.length - 1);
        var k = j.split('/');
        if (k.length >= 3 && k[2] === 'photos')if (k.length === 4 && /^\d+$/.exec(k[3]) !== null) {
            return {photo_id: k[3], set_token: null};
        } else if (k.length === 5 && /^\d+$/.exec(k[4]) !== null)return {photo_id: k[4], set_token: k[3]};
        return null;
    }, isValidLegacy: function (h) {
        var i = h.getPath();
        if (i[i.length - 1] === '/')i = i.substring(0, i.length - 1);
        if (i === '/photo.php' || i === '/force_photo/photo.php' || i === '/photo' || i === '/force_photo/photo/index.php' || i === '/photo/index.php' || i === '/force_photo/photo')return true;
        return false;
    }};
    e.exports = g;
}, null);
__d("PhotoTagSearchPivotLogger", ["Banzai"], function (a, b, c, d, e, f, g) {
    var h = {};
    g.subscribe(g.SHUTDOWN, function () {
        Object.keys(h).forEach(function (l) {
            var m = h[l];
            Object.keys(m).forEach(function (n) {
                g.post('photo_tag_search_pivot', {source: l, action: n, count: m[n]});
            });
        });
    });
    var i = /^(perm:)?tag:/, j, k = {logImpression: function (l, m) {
        var n = l in h ? h[l] : (h[l] = {});
        n[m] = m in n ? n[m] + 1 : 1;
    }, logImageImpression: function (l, m, n) {
        if (j !== m) {
            if (n.some(function (o) {
                return i.test(o);
            }))this.logImpression(l, 'image_impression');
            j = m;
        }
    }, logPivotImpression: function (l, m) {
        if (i.test(m))this.logImpression(l, 'pivot_impression');
    }, logShowMorePhotos: function () {
        this.logImpression('photoset', 'show_more_photos');
    }, logHideMorePhotos: function () {
        this.logImpression('photoset', 'hide_more_photos');
    }, logSuggestMorePhotos: function () {
        this.logImpression('photoset', 'suggest_more_photos');
    }, logMorePhotosNavigation: function (l) {
        g.post('photo_tag_search_pivot', {source: 'photoset', action: 'more_photos_search', query: l, count: 1});
    }};
    e.exports = k;
}, null);
__d("PhotosetSearchPivot.react", ["LeftRight.react", "PhotoTagSearchPivotLogger", "PhotosetSearchPivotData", "React", "XUISpinner.react", "XUIText.react", "cx", "fbt", "joinClasses"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o) {
    var p = j.createClass({displayName: 'PhotosetSearchPivotItem', propTypes: {normalized: j.PropTypes.string, title: j.PropTypes.string, uri: j.PropTypes.string, images: j.PropTypes.array}, onClick: function () {
        h.logMorePhotosNavigation(this.props.normalized);
    }, render: function () {
        return (j.createElement(j.DOM.div, {className: "_25r"}, j.createElement(j.DOM.a, {onClick: this.onClick, href: this.props.uri, className: "_25t _3-8t"}, j.createElement(j.DOM.div, {className: "_25u"}, j.createElement(j.DOM.div, {className: "_25v _25w", style: {backgroundImage: 'url(' + this.props.images[0].uri + ')'}}), j.createElement(j.DOM.div, {className: "_25x"}, j.createElement(j.DOM.div, {className: "_25y"}, j.createElement(j.DOM.div, {className: "_25z"}), j.createElement(j.DOM.div, {className: "_26r"}, j.createElement(j.DOM.div, {className: "_273 _25w", style: {backgroundImage: 'url(' + this.props.images[1].uri + ')'}}))), j.createElement(j.DOM.div, {className: "_274"}, j.createElement(j.DOM.div, {className: "_25z"}), j.createElement(j.DOM.div, {className: "_26r"}, j.createElement(j.DOM.div, {className: "_273 _25w", style: {backgroundImage: 'url(' + this.props.images[2].uri + ')'}}))))), j.createElement(l, {display: "block", className: "_27f _2pi4"}, this.props.title))));
    }}), q = j.createClass({displayName: 'PhotosetSearchPivot', propTypes: {fbid: j.PropTypes.string, endofalbum: j.PropTypes.bool, withBackground: j.PropTypes.bool, linesAroundHeader: j.PropTypes.bool, onclose: j.PropTypes.func}, fetchPivots: function (r) {
        i.fetch(r).then(function (s) {
            var t = s.pivots;
            setTimeout(function () {
                this.setState({pivots: t || [], action: 'show'});
            }.bind(this), 0);
        }.bind(this), function (s) {
            setTimeout(function () {
                this.setState({pivots: [], action: 'show'});
            }.bind(this), 0);
        }.bind(this));
    }, getInitialState: function () {
        this.fetchPivots(this.props.fbid);
        return {pivots: [], action: 'loading'};
    }, componentWillReceiveProps: function (r) {
        if (r.fbid) {
            this.setState({action: 'loading'});
            this.fetchPivots(r.fbid);
        } else {
            this.setState({action: 'hide'});
            setTimeout(function () {
                if (this.state.action === 'hide')this.setState({pivots: [], action: ''});
            }.bind(this), 1000);
        }
    }, onExitClicked: function () {
        this.props.onclose();
    }, render: function () {
        if (this.state.action === 'loading')return (j.createElement(j.DOM.div, {className: o(this.props.className, "_27h _2ph_")}, j.createElement(k, {size: "large"})));
        if (this.state.pivots.length === 0 && this.state.action !== 'show')return j.createElement(j.DOM.span, null);
        var r;
        if (this.state.pivots.length > 0) {
            r = this.state.pivots.map(function (v) {
                return (j.createElement(p, {normalized: v.normalized, title: v.title, uri: v.uri, images: v.images}));
            });
        } else r = j.createElement(j.DOM.div, {className: "_27i"}, "Unfortunately, there doesn't seem to be any other relevant photos available.");
        var s = this.props.endofalbum ? j.createElement(j.DOM.span, {className: "_2pij"}, "\u041a\u043e\u043d\u0435\u0446 \u0430\u043b\u044c\u0431\u043e\u043c\u0430") : null, t = (("_27m") + (' ' + "_2pi3") + (' ' + "_2pib") + (this.props.linesAroundHeader ? ' ' + "_3-te" : '')), u = j.createElement(j.DOM.span, null, s, j.createElement(j.DOM.span, {className: "_4ptz"}, "\u0414\u0440\u0443\u0433\u0438\u0435 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0432\u0430\u043c \u043f\u043e\u043d\u0440\u0430\u0432\u0438\u0442\u044c\u0441\u044f"));
        if (this.props.onclose) {
            u = j.createElement(g, {className: t}, u, j.createElement(j.DOM.a, {href: "#", onClick: this.onExitClicked, className: "_27n"}));
        } else u = j.createElement(j.DOM.div, {className: t}, u);
        return (j.createElement(j.DOM.div, {className: o(this.props.className, ((this.state.action === 'hide' ? "_27j" : '') + (this.state.action === 'show' ? ' ' + "_27k" : '')))}, j.createElement(j.DOM.div, {className: (("_27l") + (this.props.withBackground ? ' ' + "_3-tf" : ''))}, u, j.createElement(j.DOM.div, {className: "_27o _2pi8 clearfix"}, r))));
    }});
    e.exports = q;
}, null);
__d("PhotosetPivotSlide.react", ["Link.react", "PhotosetSearchPivot.react", "React", "XUIGlyph.react", "XUIGlyphConstants", "XUIText.react", "cx", "fbt"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n) {
    var o = i.createClass({displayName: 'PhotosetPivotSlide', propTypes: {fbid: i.PropTypes.string, visible: i.PropTypes.bool, onReturn: i.PropTypes.func}, render: function () {
        return (i.createElement(i.DOM.div, {className: (("_1_ap") + (this.props.visible ? ' ' + "_1_aq" : ''))}, i.createElement(i.DOM.div, {className: "_1_ar"}, i.createElement(l, {display: "block"}, "\u041a\u043e\u043d\u0435\u0446 \u0430\u043b\u044c\u0431\u043e\u043c\u0430"), i.createElement(g, {className: "_1_as", onClick: this.props.onReturn}, i.createElement(j, {className: "_1_at", image: k.ARROW_RIGHT, shade: "white", size: "small"}), "Return to Beginning")), i.createElement(h, {className: "_1_au", fbid: this.props.visible ? this.props.fbid : null, linesAroundHeader: true})));
    }});
    e.exports = o;
}, null);
__d("AssertionError", ["ManagedError"], function (a, b, c, d, e, f, g) {
    function h(i) {
        g.prototype.constructor.apply(this, arguments);
    }

    h.prototype = new g();
    h.prototype.constructor = h;
    e.exports = h;
}, null);
__d("Assert", ["AssertionError", "sprintf"], function (a, b, c, d, e, f, g, h) {
    function i(n, o) {
        if (typeof n !== 'boolean' || !n)throw new g(o);
        return n;
    }

    function j(n, o, p) {
        var q;
        if (o === undefined) {
            q = 'undefined';
        } else if (o === null) {
            q = 'null';
        } else {
            var r = Object.prototype.toString.call(o);
            q = /\s(\w*)/.exec(r)[1].toLowerCase();
        }
        i(n.indexOf(q) !== -1, p || h('Expression is of type %s, not %s', q, n));
        return o;
    }

    function k(n, o, p) {
        i(o instanceof n, p || 'Expression not instance of type');
        return o;
    }

    function l(n, o) {
        m['is' + n] = o;
        m['maybe' + n] = function (p, q) {
            if (p != null)o(p, q);
        };
    }

    var m = {isInstanceOf: k, isTrue: i, isTruthy: function (n, o) {
        return i(!!n, o);
    }, type: j, define: function (n, o) {
        n = n.substring(0, 1).toUpperCase() + n.substring(1).toLowerCase();
        l(n, function (p, q) {
            i(o(p), q);
        });
    }};
    ['Array', 'Boolean', 'Date', 'Function', 'Null', 'Number', 'Object', 'Regexp', 'String', 'Undefined'].forEach(function (n) {
        l(n, j.bind(null, n.toLowerCase()));
    });
    e.exports = m;
}, null);
__d("PhotoSnowliftAds", ["Arbiter", "Event", "copyProperties", "CSS", "csx", "DataStore", "DOM", "PhotoSessionLog", "UIPagelet", "URI", "Vector", "extendArray"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r) {
    var s = {REFRESH_RATE: 30000, UNITS_REGISTER_DELAY: 1000, root: null, availableDimensions: null, loadQuery: null, lastLoadTime: 0, minAds: 100, units: null, isLogAdData: null, displayedCallback: null, position: null, adsStatus: 'null', adsEvents: {}, resetEvents: function () {
        this.adsStatus = 'reset';
        this.adsEvents = {};
    }, addEvent: function (t, u) {
        if (u)this.adsStatus = t;
        var v = Date.now();
        this.adsEvents[t + '_' + v] = v;
    }, init: function (t, u, v, w) {
        this.reset();
        this.root = t;
        this.snowlift = u;
        this.minAds = v.min_ads;
        this.displayedCallback = w;
        this.addEvent('init', true);
    }, reset: function () {
        this.lastLoadTime = 0;
        this.position = 0;
        this.units = [];
        this.resetEvents();
        this.addEvent('reset', true);
    }, resize: function (t) {
        this.availableDimensions = t;
        this.loadQuery = this.snowlift.getLoadQuery();
        this.processResize();
    }, calculateUnitSizes: function (t, u, v) {
        var w = {};
        t.forEach(function (x) {
            var y = x.root.firstChild.offsetHeight;
            x.units.forEach(function (aa) {
                if (!j.hasClass(aa, 'hidden') && !this.getIsHoldout(aa) && !this.getIsShadow(aa)) {
                    var ba = this.getHeight(aa.firstChild, u);
                    y -= ba;
                }
            }.bind(this));
            var z = {height: y, visible: false};
            x.units.forEach(function (aa) {
                var ba = this.getIsAds(aa), ca = this.getHeight(aa.firstChild, u), da = this.getUnitId(aa), ea = this.getIsHoldout(aa);
                if (ea && v)return;
                w[da] = {height: ca, visible: false, priority: 0, is_ads: ba, is_holdout: ea, section_ref: z};
            }.bind(this));
        }.bind(this));
        return w;
    }, calculateVisibleUnits: function (t, u, v) {
        var w = 0, x = this.getUnitPriority(u);
        x.forEach(function (y) {
            if (u.hasOwnProperty(y)) {
                var z = u[y], aa = z.height;
                if (!z.section_ref.visible)aa += z.section_ref.height;
                z.height_below = v - aa;
                z.visible = z.height_below >= 0 && aa > 0;
                if (z.visible) {
                    z.section_ref.visible = true;
                    v -= aa;
                    w++;
                }
            }
        }.bind(this));
        return u;
    }, displayUnits: function (t, u) {
        t.forEach(function (v) {
            var w = false, x = true;
            v.units.forEach(function (y) {
                var z = this.getUnitId(y), aa = u[z];
                if (!aa)return;
                var ba = aa.visible, ca = aa.height_below, da = aa.is_ads;
                j.conditionClass(y, 'hidden', !ba);
                if (da && ba && x) {
                    var ea = m.find(y, 'div.ego_unit');
                    j.addClass(ea, 'ego_unit_no_top_border');
                    x = false;
                }
                w = w || ba;
                this.calcUnitStats(this.units[da][z], ba, ca);
            }.bind(this));
            j.conditionClass(v.root, 'hidden', !w);
        }.bind(this));
        g.inform('PhotoSnowliftAds/displayUnits');
    }, getUnitsDisplayed: function (t, u) {
        var v = 0;
        t.forEach(function (w) {
            w.units.forEach(function (x) {
                var y = this.getUnitId(x), z = u[y];
                if (!z || !z.visible)return;
                v++;
            }.bind(this));
        }.bind(this));
        return v;
    }, getHeightsRequired: function (t, u) {
        var v = 0, w = [];
        t.forEach(function (x) {
            var y = false;
            x.units.forEach(function (z) {
                var aa = this.getUnitId(z), ba = u[aa];
                if (!ba)return;
                v += ba.height;
                if (!y) {
                    v += ba.section_ref.height;
                    y = true;
                }
                w.push(v);
            }.bind(this));
        }.bind(this));
        return w;
    }, getUnitPriority: function (t) {
        var u = [], v = 0, w = 0;
        for (var x in t) {
            var y = t[x];
            u.push(x);
            var z = this.minAds + v + w;
            if (y.is_ads) {
                if (w < this.minAds)z = w;
                w++;
            } else v++;
            y.priority = z;
        }
        u = u.sort(function (aa, ba) {
            var ca = t[aa], da = t[ba];
            return ca.priority - da.priority;
        }.bind(this));
        return u;
    }, updateUnitsStatus: function () {
        var t = this.availableDimensions.x, u = this.availableDimensions.y, v = this.calculateUnitSizes(this.sections, t);
        v = this.calculateVisibleUnits(this.sections, v, u);
        for (var w in v) {
            if (!v.hasOwnProperty(w))continue;
            var x = v[w];
            if (!x.is_holdout || !x.visible)continue;
            var y = this.units[1][w];
            this.calcUnitStats(y, x.visible, x.height_below);
        }
        v = this.calculateUnitSizes(this.sections, t, true);
        v = this.calculateVisibleUnits(this.sections, v, u);
        this.displayUnits(this.sections, v);
        if (this.displayedCallback) {
            var z = this.getUnitsDisplayed(this.sections, v), aa = this.getHeightsRequired(this.sections, v);
            this.displayedCallback(z, aa);
        }
    }, calcUnitStats: function (t, u, v) {
        var w = Date.now();
        if (t.visible)t.totalTime += w - t.lastShowTime;
        if (t.trackingCode !== null && t.totalTime >= this.UNITS_REGISTER_DELAY) {
            var x = t.trackingCode;
            t.trackingCode = null;
            this.registerImpression(x, t.registerUrl);
        }
        t.visible = u;
        t.heightBelow = v;
        t.lastShowTime = w;
    }, prepareResize: function () {
        var t = function (u) {
            var v = m.create('div', {className: 'inner'}), w = m.create('div', {className: 'wrapper'}, v);
            m.replace(u, w);
            m.setContent(v, u);
            return w;
        };
        this.sections = m.scry(this.root, 'div.ego_section').map(function (u) {
            return {root: t(u), units: m.scry(u, 'div.ego_unit').map(t)};
        });
    }, processResize: function () {
        if (this.isLoading || this.lastLoadTime === 0 || this.availableDimensions === null) {
            this.setLogData();
            return;
        }
        this.updateUnitsStatus();
        this.setLogData();
        var t = this.nextRegisterTime();
        if (t !== Infinity)setTimeout(this.processResize.bind(this), t);
    }, setIsLogAdData: function (t) {
        this.isLogAdData = t;
        this.addEvent('setIsLogAdData', false);
        this.setLogData();
    }, setLogData: function () {
        var t = this.snowlift.getImageId();
        if (this.isLogAdData && t) {
            var u = q.getElementDimensions(this.snowlift.getImage()), v = q.getElementDimensions(this.snowlift.getRHCHeader()), w = q.getElementDimensions(this.snowlift.getRHCBody()), x = q.getElementDimensions(this.snowlift.getRHCFooter()), y = {query_set: this.snowlift.getLoadQuery().set, window_x: window.innerWidth, window_y: window.innerHeight, image_x: u.x, image_y: u.y, header_x: v.x, header_y: v.y, body_x: w.x, body_y: w.y, footer_x: x.x, footer_y: x.y, ads_below_space: this.getAdsBelowSpace(), time: Date.now(), adsStatus: this.adsStatus, adsEvents: this.adsEvents, refreshRate: this.refreshUnitsRate, position: this.position};
            n.updateAdData(t, y);
        }
    }, getAdsBelowSpace: function () {
        var t = [], u = this.units[1];
        for (var v in u)if (u.hasOwnProperty(v) && !this.getIsHoldout(this.getAdUnit(v)))t.push(u[v].heightBelow);
        return t;
    }, getIsAds: function (t) {
        var u = m.scry(t, "div._4u8");
        return u.length;
    }, getUnitId: function (t) {
        if (this.getIsAds(t)) {
            return this.getAdId(t);
        } else return this.getEgoId(t);
    }, getEgoId: function (t) {
        var u = m.find(t, 'div.ego_unit');
        return u.getAttribute('data-ego-fbid');
    }, getAdData: function (t) {
        var u = m.find(t, "div._4u8"), v = u.getAttribute('data-ad');
        return v && JSON.parse(v) || {};
    }, getAdId: function (t) {
        return this.getAdData(t).adid;
    }, getIsHoldout: function (t) {
        return t && this.getIsAds(t) && this.getAdData(t).holdout;
    }, getIsShadow: function (t) {
        return t && this.getIsAds(t) && this.getAdData(t).shadow;
    }, getAdUnit: function (t) {
        if (!this.sections)return null;
        var u = [];
        this.sections.forEach(function (w) {
            r(u, w.units);
        });
        for (var v = 0; v < u.length; v++)if (this.getIsAds(u[v]) && this.getAdId(u[v]) == t)return u[v];
        return null;
    }, nextRegisterTime: function () {
        var t = Infinity, u = i(i({}, this.units[0]), this.units[1]);
        for (var v in u)if (u.hasOwnProperty(v)) {
            var w = u[v];
            if (w.trackingCode !== null && w.visible)t = Math.min(t, this.UNITS_REGISTER_DELAY - w.totalTime);
        }
        return t;
    }, getHeight: function (t, u) {
        var v = l.get(t, 'height');
        if (v && v.x === u)return v.y;
        return this.cacheHeight(t, u);
    }, cacheHeight: function (t, u) {
        var v = {x: u, y: t.offsetHeight};
        l.set(t, 'height', v);
        return v.y;
    }, loadAdsAndEgo: function () {
        this.resetEvents();
        this.addEvent('adsRequested', true);
        this.position++;
        var t = this.getCursorFBID(this.loadQuery);
        o.loadFromEndpoint('WebEgoPane', this.root, {pid: 34, data: [this.loadQuery.set, t, false, this.snowlift.getOpaqueCursor(t)]}, {crossPage: true, bundle: false});
    }, getCursorFBID: function (t) {
        if (t.v !== undefined)return t.v;
        if (t.fbid !== undefined)return t.fbid;
        return '0';
    }, unitsLoaded: function (t, u) {
        var v;
        if (u) {
            v = '/ai.php';
            this.addEvent('adsLoaded', true);
        } else {
            v = '/ajax/ei.php';
            this.addEvent('egoLoaded', true);
        }
        var w = {};
        for (var x in t)if (t.hasOwnProperty(x))w[x] = {trackingCode: t[x], totalTime: 0, lastShowTime: 0, heightBelow: -10000, visible: false, registerUrl: v};
        this.units[u] = w;
        if (u)this.waitForImages(this.imagesLoaded.bind(this));
    }, imagesLoaded: function () {
        this.prepareResize();
        this.addEvent('imagesLoaded', true);
        this.lastLoadTime = Date.now();
        this.isLoading = false;
        this.processResize();
        j.removeClass(this.root, 'loading');
    }, loadAdsFromUserActivity: function () {
        var t = Date.now() - this.lastLoadTime;
        if (!this.isLoading && t > s.REFRESH_RATE) {
            j.addClass(this.root, 'loading');
            this.isLoading = true;
            this.loadAdsAndEgo();
        }
    }, registerImpression: function (t, u) {
        var v = m.create('iframe', {src: p(u).addQueryData({aed: t}), width: 0, height: 0, frameborder: 0, scrolling: 'no', className: 'fbEmuTracking'});
        v.setAttribute('aria-hidden', 'true');
        m.appendContent(this.root, v);
    }, waitForImages: function (t) {
        var u = m.scry(this.root, 'img.img'), v = u.length, w = v;
        if (w === 0)t();
        var x = function () {
            w--;
            if (w === 0)setTimeout(t, 0);
        };
        for (var y = 0; y < v; y++) {
            var z = u[y];
            if (z.complete) {
                x();
            } else h.listen(z, {load: x, error: x, abort: x});
        }
    }};
    e.exports = s;
}, null);
__d("PhotoViewer", ["Bootloader", "CSS", "DOM", "copyProperties", "emptyFunction"], function (a, b, c, d, e, f, g, h, i, j, k) {
    function l() {
        "use strict";
        this.image = null;
        this.root = null;
        this.stream = null;
    }

    l.prototype.getEventString = function (m) {
        "use strict";
        var n = this.getEventPrefix();
        if (n)return n + '.' + m;
        return null;
    };
    l.prototype.getImage = function () {
        "use strict";
        return this.image;
    };
    l.prototype.getPosition = function () {
        "use strict";
        return this.stream ? this.stream.getCursor() : null;
    };
    l.prototype.getRoot = function () {
        "use strict";
        return this.root;
    };
    l.prototype.hiliteAllBoxes = function () {
        "use strict";
        i.scry(this.stageWrapper, 'div.tagsWrapper div.faceBox').forEach(function (m) {
            h.addClass(m, 'otherActive');
        });
    };
    l.bootstrap = function (m, n) {
        "use strict";
        g.loadModules(["PhotoSnowlift"], function (o) {
            o.bootstrap(m, n);
        });
    };
    j(l.prototype, {getEventPrefix: k.thatReturnsNull, getSourceString: k.thatReturnsNull, getVersionConst: k.thatReturnsNull, getViewerSource: k.thatReturnsNull, getViewerSet: k.thatReturnsNull});
    e.exports = l;
}, null);
__d("logVideosClickTracking", ["clickRefAction"], function (a, b, c, d, e, f, g) {
    function h(i) {
        g('click', i, null, 'FORCE');
    }

    e.exports = h;
}, null);
__d("VideoCTAEndscreen", ["CSS", "DOM", "Event", "VideoPlayerReason", "SubscriptionsHandler", "VideoPlayerLoggerEvents", "VideoPlayerReason", "csx", "logVideosClickTracking"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o) {
    function p(q, r) {
        "use strict";
        this.$VideoCTAEndscreen0 = q;
        this.$VideoCTAEndscreen1 = r.endscreenElement;
        this.$VideoCTAEndscreen2 = r.replayElement || h.find(this.$VideoCTAEndscreen1, "._5j_6");
        this.$VideoCTAEndscreen3 = new k();
        if (this.$VideoCTAEndscreen2 != null)this.$VideoCTAEndscreen3.addSubscriptions(i.listen(this.$VideoCTAEndscreen2, 'click', function () {
            return this.$VideoCTAEndscreen4();
        }.bind(this)));
        if (q.addListener)this.$VideoCTAEndscreen3.addSubscriptions(q.addListener('finishPlayback', function () {
            return this.$VideoCTAEndscreen5();
        }.bind(this)), q.addListener('beginPlayback', function () {
            return this.$VideoCTAEndscreen6();
        }.bind(this)));
    }

    p.prototype.$VideoCTAEndscreen4 = function () {
        "use strict";
        var q = {reason: j.USER};
        this.$VideoCTAEndscreen0.logEvent(l.REPLAYED, q);
        o(this.$VideoCTAEndscreen0.getVideoNode());
        this.$VideoCTAEndscreen0.play(m.USER);
    };
    p.prototype.$VideoCTAEndscreen5 = function () {
        "use strict";
        g.show(this.$VideoCTAEndscreen1);
    };
    p.prototype.$VideoCTAEndscreen6 = function () {
        "use strict";
        g.hide(this.$VideoCTAEndscreen1);
    };
    p.prototype.handleFlashEvent = function (q, r) {
        "use strict";
        if (this.$VideoCTAEndscreen1 == null)return;
        if (!this.$VideoCTAEndscreen0.addListener)switch (q) {
            case 'flash/beginPlayback':
                this.$VideoCTAEndscreen6();
                break;
            case 'flash/finishPlayback':
                this.$VideoCTAEndscreen5();
                break;
        }
    };
    e.exports = p;
}, null);
__d("VideoPlayerApiEvents", [], function (a, b, c, d, e, f) {
    var g = ['buffered', 'buffering', 'beginPlayback', 'updateStatus', 'logEvent', 'pausePlayback', 'clickForTracking', 'finishPlayback', 'unmuteVideo', 'openLargeFormat', 'turnOffAutoplay', 'expandVideo'];
    e.exports = g;
}, null);
__d("AbstractVideoPlayerApi", ["EventEmitter", "VideoPlayerApiEvents", "arrayContains", "invariant"], function (a, b, c, d, e, f, g, h, i, j) {
    for (var k in g)if (g.hasOwnProperty(k))m[k] = g[k];
    var l = g === null ? null : g.prototype;
    m.prototype = Object.create(l);
    m.prototype.constructor = m;
    m.__superConstructor__ = g;
    function m() {
        "use strict";
        l.constructor.call(this);
    }

    m.prototype.addListener = function () {
        "use strict";
        var n = Array.prototype.slice.call(arguments, 0);
        return l.addListener.apply(this, n);
    };
    m.prototype.emit = function () {
        "use strict";
        var n = Array.prototype.slice.call(arguments, 0);
        return l.emit.apply(this, n);
    };
    e.exports = m;
}, null);
__d("VideoPlayerFlashApi", ["AbstractVideoPlayerApi", "Arbiter", "DOMQuery", "SubscriptionsHandler", "VideoPlayerApiEvents", "destroyOnUnload", "invariant"], function (a, b, c, d, e, f, g, h, i, j, k, l, m) {
    function n(s) {
        if (s.hasAttribute('data-flash'))return s.getAttribute('id');
        return i.find(s, 'div[data-flash]').getAttribute('id');
    }

    function o(s) {
        var t = i.scry(s, 'embed');
        if (!t.length)t = i.scry(s, 'object');
        m(t.length);
        return t[0];
    }

    for (var p in g)if (g.hasOwnProperty(p))r[p] = g[p];
    var q = g === null ? null : g.prototype;
    r.prototype = Object.create(q);
    r.prototype.constructor = r;
    r.__superConstructor__ = g;
    function r(s, t) {
        "use strict";
        q.constructor.call(this);
        this.$VideoPlayerFlashApi0 = o(s);
        this.$VideoPlayerFlashApi1 = n(s);
        this.$VideoPlayerFlashApi2 = new j();
        this.$VideoPlayerFlashApi2.addSubscriptions(h.subscribe(k.map(function (u) {
            return 'flash/' + u;
        }), this.$VideoPlayerFlashApi3.bind(this)));
        l(function () {
            return this.$VideoPlayerFlashApi2.release();
        }.bind(this));
        this.$VideoPlayerFlashApi4 = t;
    }

    r.onImplementationReady = function (s, t) {
        "use strict";
        var u = n(s), v = h.subscribe('flash/ready', function (w, x) {
            if (x.divID === u) {
                h.unsubscribeCurrentSubscription();
                h.releaseCurrentPersistentEvent();
                t(s);
            }
        });
        l(function () {
            return v.unsubscribe();
        });
    };
    r.prototype.$VideoPlayerFlashApi3 = function (s, t) {
        "use strict";
        if (t.divID !== this.$VideoPlayerFlashApi1)return;
        var u = s.substr('flash/'.length);
        this.emit(u, t);
    };
    r.prototype.pause = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('pauseVideo', s);
    };
    r.prototype.play = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('playVideo', s, true);
    };
    r.prototype.seek = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('seekVideo', s);
    };
    r.prototype.setScriptPath = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('setScriptPath', s);
    };
    r.prototype.setFTData = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('setFTData', s);
    };
    r.prototype.switchVideo = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('switchVideo', s);
    };
    r.prototype.unmute = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0);
        this.$VideoPlayerFlashApi5('unmuteVideo', s);
    };
    r.prototype.getVideoInfo = function () {
        "use strict";
        var s = Array.prototype.slice.call(arguments, 0), t = this.$VideoPlayerFlashApi5('getVideoInfo', s, false);
        if (t) {
            return JSON.parse(t);
        } else return null;
    };
    r.prototype.$VideoPlayerFlashApi5 = function (s, t, u) {
        "use strict";
        try {
            if (typeof this.$VideoPlayerFlashApi0[s] === 'function') {
                return this.$VideoPlayerFlashApi0[s].apply(this.$VideoPlayerFlashApi0, t);
            } else throw new Error(s + ' is not a valid method on the flash object');
        } catch (v) {
            this.$VideoPlayerFlashApi4 && this.$VideoPlayerFlashApi4(v, u);
        }
    };
    e.exports = r;
}, null);
__d("HTMLMediaElementNetworkStates", [], function (a, b, c, d, e, f) {
    var g = {NETORK_EMPTY: 0, NETWORK_IDLE: 1, NETWORK_LOADING: 2, NETWORK_NO_SOURCE: 3};
    e.exports = g;
}, null);
__d("HTMLMediaElementReadyStates", [], function (a, b, c, d, e, f) {
    var g = {HAVE_NOTHING: 0, HAVE_METADATA: 1, HAVE_CURRENT_DATA: 2, HAVE_FUTURE_DATA: 3, HAVE_ENOUGH_DATA: 4};
    e.exports = g;
}, null);
__d("onCanPlayHTMLMediaElement", ["EventListener", "HTMLMediaElementReadyStates", "invariant", "setImmediate"], function (a, b, c, d, e, f, g, h, i, j) {
    function k(m) {
        return m >= h.HAVE_FUTURE_DATA;
    }

    function l(m, n) {
        i(m instanceof window.HTMLMediaElement);
        if (k(m.readyState))j(n);
        return g.listen(m, 'canplay', n);
    }

    e.exports = l;
}, null);
__d("VideoPlayerHTML5Api", ["AbstractVideoPlayerApi", "Arbiter", "EventListener", "HTMLMediaElementNetworkStates", "HTMLMediaElementReadyStates", "HVideoPlayerMixin", "SubscriptionsHandler", "VideoPlayerReason", "classWithMixins", "destroyOnUnload", "mixin", "onCanPlayHTMLMediaElement"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r) {
    var s = -1, t = o(g, q(l));
    for (var u in t)if (t.hasOwnProperty(u))w[u] = t[u];
    var v = t === null ? null : t.prototype;
    w.prototype = Object.create(v);
    w.prototype.constructor = w;
    w.__superConstructor__ = t;
    function w(x) {
        "use strict";
        v.constructor.call(this);
        this.$VideoPlayerHTML5Api0 = x;
        this.$VideoPlayerHTML5Api1 = x.id;
        this.$VideoPlayerHTML5Api2 = JSON.parse(x.getAttribute('data-config'));
        this.$VideoPlayerHTML5Api3 = {};
        this.$VideoPlayerHTML5Api4 = s;
        this.$VideoPlayerHTML5Api5 = x.muted;
        this.$VideoPlayerHTML5Api6 = x.volume;
        this.$VideoPlayerHTML5Api7 = false;
        this.$VideoPlayerHTML5Api8 = s;
        this.$VideoPlayerHTML5Api9 = null;
        this.$VideoPlayerHTML5Apia = new m();
        p(function () {
            return this.$VideoPlayerHTML5Apia.release();
        }.bind(this));
        this.initLogger(function (event, y) {
            return this.$VideoPlayerHTML5Apib(event, y);
        }.bind(this));
        this.$VideoPlayerHTML5Apic();
    }

    w.prototype.getAdClientToken = function () {
        "use strict";
        this.$VideoPlayerHTML5Api2.ad_client_token;
    };
    w.prototype.getVideoID = function () {
        "use strict";
        return this.$VideoPlayerHTML5Api2.video_id;
    };
    w.prototype.getDOMElement = function () {
        "use strict";
        return this.$VideoPlayerHTML5Api0;
    };
    w.prototype.getVideoElement = function () {
        "use strict";
        return this.$VideoPlayerHTML5Api0;
    };
    w.prototype.getSubscriptions = function () {
        "use strict";
        return this.$VideoPlayerHTML5Apia;
    };
    w.onImplementationReady = function (x, y) {
        "use strict";
        if (x.networkState <= j.NETWORK_IDLE && x.readyState === k.HAVE_NOTHING)return y();
        var z = r(x, function () {
            z.remove();
            z = null;
            y();
        });
        p(function () {
            if (z)z.remove();
        });
    };
    w.prototype.getVideoInfo = function () {
        "use strict";
        return null;
    };
    w.prototype.pause = function (x) {
        "use strict";
        this.$VideoPlayerHTML5Api9 = x;
        this.$VideoPlayerHTML5Api0.pause();
    };
    w.prototype.play = function (x) {
        "use strict";
        this.$VideoPlayerHTML5Api0.play();
    };
    w.prototype.seek = function (x) {
        "use strict";
    };
    w.prototype.setFTData = function (x) {
        "use strict";
    };
    w.prototype.switchVideo = function (x) {
        "use strict";
    };
    w.prototype.unmute = function () {
        "use strict";
        this.$VideoPlayerHTML5Api0.muted = false;
    };
    w.prototype.$VideoPlayerHTML5Apic = function () {
        "use strict";
        this.$VideoPlayerHTML5Apia.addSubscriptions(i.listen(this.$VideoPlayerHTML5Api0, 'playing', this.$VideoPlayerHTML5Apid.bind(this)), i.listen(this.$VideoPlayerHTML5Api0, 'ended', this.$VideoPlayerHTML5Apie.bind(this)), i.listen(this.$VideoPlayerHTML5Api0, 'pause', this.$VideoPlayerHTML5Apif.bind(this)), i.listen(this.$VideoPlayerHTML5Api0, 'volumechange', this.$VideoPlayerHTML5Apig.bind(this)), i.listen(this.$VideoPlayerHTML5Api0, 'mousedown', this.$VideoPlayerHTML5Apih.bind(this)), i.listen(this.$VideoPlayerHTML5Api0, 'mouseup', this.$VideoPlayerHTML5Apii.bind(this)));
    };
    w.prototype.$VideoPlayerHTML5Apig = function () {
        "use strict";
        if (this.$VideoPlayerHTML5Api0.muted !== this.$VideoPlayerHTML5Api5 && this.$VideoPlayerHTML5Api0.volume === this.$VideoPlayerHTML5Api6 && this.$VideoPlayerHTML5Api0.volume > 0)if (!this.$VideoPlayerHTML5Api0.muted) {
            this.$VideoPlayerHTML5Apij('flash/turnOffAutoplay');
            this.$VideoPlayerHTML5Apij('flash/unmuteVideo');
        }
        this.$VideoPlayerHTML5Api5 = this.$VideoPlayerHTML5Api0.muted;
        this.$VideoPlayerHTML5Api6 = this.$VideoPlayerHTML5Api0.volume;
    };
    w.prototype.$VideoPlayerHTML5Apih = function (x) {
        "use strict";
        if (x.button === 0)this.$VideoPlayerHTML5Api7 = true;
    };
    w.prototype.$VideoPlayerHTML5Apii = function (x) {
        "use strict";
        if (x.butteon === 0)this.$VideoPlayerHTML5Api7 = false;
    };
    w.prototype.$VideoPlayerHTML5Apid = function () {
        "use strict";
        this.$VideoPlayerHTML5Api0.controls = true;
        this.$VideoPlayerHTML5Apij('flash/beginPlayback', {position: this.getLastStartTimePosition()});
    };
    w.prototype.$VideoPlayerHTML5Apif = function (x) {
        "use strict";
        if (this.$VideoPlayerHTML5Api0.seeking)return;
        if (this.$VideoPlayerHTML5Api7)return;
        if (this.$VideoPlayerHTML5Api9 === null || this.$VideoPlayerHTML5Api9 === n.USER)this.$VideoPlayerHTML5Apij('flash/turnOffAutoplay');
        this.$VideoPlayerHTML5Api9 = null;
        this.$VideoPlayerHTML5Api0.controls = false;
        this.$VideoPlayerHTML5Apij('flash/pausePlayback', {position: this.getLastStartTimePosition()});
    };
    w.prototype.$VideoPlayerHTML5Apie = function () {
        "use strict";
        this.$VideoPlayerHTML5Api0.controls = false;
        this.$VideoPlayerHTML5Apij('flash/finishPlayback');
    };
    w.prototype.$VideoPlayerHTML5Apib = function (event, x) {
        "use strict";
        this.$VideoPlayerHTML5Apij('flash/logEvent', {logData: Object.assign({event: event}, x)});
    };
    w.prototype.$VideoPlayerHTML5Apij = function (event, x) {
        "use strict";
        h.inform(event, Object.assign({divID: this.$VideoPlayerHTML5Api1}, x));
        this.emit(event.substr('flash/'.length), x);
    };
    e.exports = w;
}, null);
__d("VideoPlayerApiFactory", ["VideoPlayerFlashApi", "VideoPlayerHTML5Api"], function (a, b, c, d, e, f, g, h) {
    var i = {create: function (j, k) {
        var l = this._getImplementationModule(j);
        return new l(j, k);
    }, _getImplementationModule: function (j) {
        var k = null;
        if (j.tagName === 'VIDEO') {
            k = h;
        } else k = g;
        return k;
    }, onImplementationReady: function (j, k) {
        var l = this._getImplementationModule(j);
        l.onImplementationReady(j, function (m) {
            return k(m, l);
        });
    }};
    e.exports = i;
}, null);
__d("VideoPlayerController", ["Banzai", "DOMDimensions", "EventEmitter", "Flash", "ScriptPath", "SubscriptionsHandler", "VideoCTAEndscreen", "VideoPlayerApiEvents", "VideoPlayerApiFactory", "VideoPlayerLogger", "VideoPlayerLoggerErrors", "VideoPlayerLoggerErrorStates", "VideoPlayerLoggerEvents", "VideoPlayerVersions", "VideoPlayerReason", "arrayContains", "collectDataAttributes", "emptyFunction", "getElementPosition", "invariant", "logVideosClickTracking", "mergeInto"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, aa, ba) {
    for (var ca in i)if (i.hasOwnProperty(ca))ea[ca] = i[ca];
    var da = i === null ? null : i.prototype;
    ea.prototype = Object.create(da);
    ea.prototype.constructor = ea;
    ea.__superConstructor__ = i;
    function ea(fa, ga) {
        "use strict";
        var ha = fa.video_id, ia = fa.video_ids, ja = fa.source, ka = fa.ad_client_token, la = fa.should_autoplay, ma = fa.player_version, na = fa.autoplay_setting, oa = fa.additional_logdata_getter, pa = ga.root_element, qa = ga.cta_endscreen, ra = ga.cta_replay_element, sa = ga.video_element;
        da.constructor.call(this);
        this.$VideoPlayerController0 = 0;
        this.$VideoPlayerController1 = la;
        this.$VideoPlayerController2 = na;
        this.$VideoPlayerController3 = ka;
        this.$VideoPlayerController4 = ma;
        this.$VideoPlayerController5 = sa;
        this.$VideoPlayerController6 = pa;
        this.$VideoPlayerController7 = false;
        this.$VideoPlayerController8 = ha;
        this.$VideoPlayerController9 = ia || [ha];
        this.$VideoPlayerControllera = oa || {get: x};
        this.$VideoPlayerControllerb = null;
        this.$VideoPlayerControllerc = null;
        this.$VideoPlayerControllerd = new p(ja);
        this.$VideoPlayerControllerd.setFTData(w(this.getRootNode(), ['ft']));
        this.$VideoPlayerControllerd.setScriptPath(k.getScriptPath());
        this.$VideoPlayerControllere = false;
        this.setState('loading');
        if (this.isImplementationUnavailable()) {
            this.$VideoPlayerControllerf();
            return;
        }
        if (qa)this.$VideoPlayerControllerg = new m(this, {endscreenElement: qa, replayElement: ra});
        o.onImplementationReady(this.getVideoNode(), function () {
            return this.onApiReady();
        }.bind(this));
        g.subscribe(g.SHUTDOWN, function () {
            this.logStopForUnload();
        }.bind(this));
        if (this.$VideoPlayerController1)this.play(u.AUTOPLAY);
    }

    ea.prototype.setAdditionalLogDataGetter = function (fa) {
        "use strict";
        this.$VideoPlayerControllera = fa;
    };
    ea.prototype.logStopForUnload = function () {
        "use strict";
        if (this.$VideoPlayerControllerb !== null && this.$VideoPlayerControllerc !== null) {
            var fa = {reason: 'unloaded', video_time_position: this.$VideoPlayerControllerb, video_last_start_time_position: this.$VideoPlayerControllerc};
            if (this.getOriginalPlayReason())fa.original_play_reason = this.getOriginalPlayReason();
            this.logEvent(s.PAUSED, fa);
            this.resetPositions();
        } else this.cancelPlayRequest();
    };
    ea.prototype.hasCTAEndscreen = function () {
        "use strict";
        return !!this.$VideoPlayerControllerg;
    };
    ea.prototype.isImplementationUnavailable = function () {
        "use strict";
        return !this.isPlayerVersion(t.HTML5) && !j.isAvailable();
    };
    ea.prototype.$VideoPlayerControllerf = function () {
        "use strict";
        var fa = {error: q.ERROR_CALLING_FLASH, state: r.PLAYER_FAILURE};
        this.logEvent(s.ERROR, fa);
        this.$VideoPlayerController1 = false;
    };
    ea.prototype.handleFlashApiFactoryError = function (fa, ga) {
        "use strict";
        var ha = {error: q.ERROR_CALLING_FLASH, error_description: fa.message, state: ga ? r.PLAYBACK_FAILURE : r.PLAYER_FAILURE};
        this.logEvent(s.ERROR, ha);
        if (ga && this.$VideoPlayerControllere)this.$VideoPlayerControllere = false;
    };
    ea.prototype.isPlayRequestPending = function () {
        "use strict";
        return this.$VideoPlayerControllere;
    };
    ea.prototype.play = function (fa) {
        "use strict";
        if (!this.$VideoPlayerControllerh)this.$VideoPlayerControllerh = fa;
        if (!this.$VideoPlayerControllere) {
            var ga = this.$VideoPlayerControlleri({reason: fa});
            this.logEvent(s.REQUESTED_PLAYING, ga);
        }
        this.sendPlayRequest(fa);
    };
    ea.prototype.sendPlayRequest = function (fa) {
        "use strict";
        if (this.isState('fallback')) {
            this.emit('fallbackPlay');
            return;
        }
        this.$VideoPlayerControllere = true;
        if (this.isState('loading')) {
            this.$VideoPlayerControllerj = {reason: fa};
        } else this.getVideoAPI().play(fa);
    };
    ea.prototype.getOriginalPlayReason = function () {
        "use strict";
        return this.$VideoPlayerControllerh;
    };
    ea.prototype.reset = function () {
        "use strict";
        if (this.isState('loading') || this.isState('fallback'))return;
        this.resetPositions();
        this.$VideoPlayerControllerk();
        this.$VideoPlayerControllerl = null;
        this.setState('loading');
        o.onImplementationReady(this.getVideoNode(), function () {
            return this.onApiReady();
        }.bind(this));
    };
    ea.prototype.cancelPlayRequest = function () {
        "use strict";
        if (this.$VideoPlayerControllere) {
            var fa = {reason: this.getOriginalPlayReason()};
            this.$VideoPlayerControllere = false;
            this.logEvent(s.CANCELLED_REQUESTED_PLAYING, fa);
        }
    };
    ea.prototype.getVideoAPI = function () {
        "use strict";
        return this.$VideoPlayerControllerl;
    };
    ea.prototype.getVideoNode = function () {
        "use strict";
        return this.$VideoPlayerController5;
    };
    ea.prototype.getRootNode = function () {
        "use strict";
        return this.$VideoPlayerController6;
    };
    ea.prototype.onApiReady = function (fa) {
        "use strict";
        this.$VideoPlayerControllerl = o.create(this.getVideoNode(), this.handleFlashApiFactoryError.bind(this));
        this.setState('ready');
        this.$VideoPlayerControllerm();
        this.setFTDataForCasablanca();
        this.setScriptPathForCasablanca();
        if (this.$VideoPlayerControllerj) {
            this.sendPlayRequest(this.$VideoPlayerControllerj.reason);
            this.$VideoPlayerControllerj = null;
        }
        if (this.$VideoPlayerControllern) {
            this.getVideoAPI().unmute();
            this.$VideoPlayerControllern = null;
        }
        var ga = {is_auto_played: this.isAutoplayable()};
        if (fa)ga.init_delay = fa;
        this.logEvent(s.PLAYER_LOADED, ga);
    };
    ea.prototype.resetPositions = function () {
        "use strict";
        this.$VideoPlayerControllerb = null;
        this.$VideoPlayerControllerc = null;
    };
    ea.prototype.$VideoPlayerControllero = function (fa) {
        "use strict";
        this.$VideoPlayerControllere = false;
        if (fa !== undefined)this.$VideoPlayerControllerc = fa;
        this.setState('playing');
    };
    ea.prototype.$VideoPlayerControllerp = function (fa) {
        "use strict";
        if (fa !== undefined)this.$VideoPlayerControllerb = fa;
    };
    ea.prototype.$VideoPlayerControllerq = function (fa) {
        "use strict";
        var event = fa.event;
        delete fa.event;
        this.logEvent(event, fa);
    };
    ea.prototype.$VideoPlayerControllerr = function () {
        "use strict";
        this.resetPositions();
        if (!this.isState('finished'))this.setState('paused');
    };
    ea.prototype.$VideoPlayerControllers = function () {
        "use strict";
        this.resetPositions();
        this.setState('finished');
    };
    ea.prototype.getVideosCount = function () {
        "use strict";
        return this.$VideoPlayerController9.length;
    };
    ea.prototype.$VideoPlayerControllert = function () {
        "use strict";
        var fa = this.getVideosCount();
        return (this.$VideoPlayerController0 + 1) % fa;
    };
    ea.prototype.$VideoPlayerControlleru = function () {
        "use strict";
        var fa = this.getVideosCount();
        return (this.$VideoPlayerController0 - 1 + fa) % fa;
    };
    ea.prototype.$VideoPlayerControllerv = function (fa) {
        "use strict";
        this.logEvent(s.CAROUSEL_CHANGE, {source_index: this.$VideoPlayerController0, target_index: fa});
        this.getVideoAPI().switchVideo(fa);
        this.$VideoPlayerController0 = fa;
        this.emit('switchVideo');
    };
    ea.prototype.unmute = function () {
        "use strict";
        if (!this.isState('loading')) {
            this.getVideoAPI().unmute();
        } else this.$VideoPlayerControllern = true;
    };
    ea.prototype.nextVideo = function () {
        "use strict";
        this.$VideoPlayerControllerv(this.$VideoPlayerControllert());
    };
    ea.prototype.previousVideo = function () {
        "use strict";
        this.$VideoPlayerControllerv(this.$VideoPlayerControlleru());
    };
    ea.prototype.getVideoIndex = function () {
        "use strict";
        return this.$VideoPlayerController0;
    };
    ea.prototype.getVideoID = function () {
        "use strict";
        return this.$VideoPlayerController9[this.getVideoIndex()];
    };
    ea.prototype.$VideoPlayerControllerm = function () {
        "use strict";
        var fa = this.$VideoPlayerControllerl;
        this.$VideoPlayerControllerw = new l();
        var ga = [
            ['buffered', function () {
                return this.setBuffering(false);
            }.bind(this)],
            ['buffering', function () {
                return this.setBuffering(true);
            }.bind(this)],
            ['beginPlayback', function (ia) {
                return this.$VideoPlayerControllero(ia.position);
            }.bind(this)],
            ['updateStatus', function (ia) {
                return this.$VideoPlayerControllerp(ia.position);
            }.bind(this)],
            ['logEvent', function (ia) {
                return this.$VideoPlayerControllerq(ia.logData);
            }.bind(this)],
            ['pausePlayback', function () {
                return this.$VideoPlayerControllerr();
            }.bind(this)],
            ['clickForTracking', function () {
                return aa(this.getVideoNode());
            }.bind(this)],
            ['finishPlayback', function () {
                return this.$VideoPlayerControllers();
            }.bind(this)]
        ], ha = function (event) {
            return this.emit.bind(this, event);
        }.bind(this);
        this.$VideoPlayerControllerw.addSubscriptions.apply(this.$VideoPlayerControllerw, ga.map(function (ia) {
            return fa.addListener.apply(fa, ia);
        }).concat(n.map(function (event) {
            return fa.addListener(event, ha(event));
        })));
    };
    ea.prototype.$VideoPlayerControllerk = function () {
        "use strict";
        if (this.$VideoPlayerControllerw)this.$VideoPlayerControllerw.release();
    };
    ea.prototype.seek = function (fa) {
        "use strict";
        this.getVideoAPI().seek(fa);
    };
    ea.prototype.pause = function (fa) {
        "use strict";
        if (this.isState('loading')) {
            this.$VideoPlayerControllerj = null;
        } else if (this.isState('playing')) {
            this.getVideoAPI().pause(fa);
            this.setState('paused');
        } else if (this.isState('ready'))this.getVideoAPI().pause(fa);
        this.cancelPlayRequest();
    };
    ea.prototype.isPlayerVersion = function (fa) {
        "use strict";
        return this.$VideoPlayerController4 === fa;
    };
    ea.prototype.isAutoplayable = function () {
        "use strict";
        return this.$VideoPlayerController1;
    };
    ea.prototype.isBuffering = function () {
        "use strict";
        return this.$VideoPlayerController7;
    };
    ea.prototype.setBuffering = function (fa) {
        "use strict";
        if (fa !== this.$VideoPlayerController7) {
            this.$VideoPlayerController7 = fa;
            if (this.$VideoPlayerController7) {
                this.$VideoPlayerControllerd.startBuffering();
            } else this.$VideoPlayerControllerd.endBuffering();
        }
    };
    ea.prototype.getDOMPosition = function () {
        "use strict";
        return y(this.getRootNode());
    };
    ea.prototype.$VideoPlayerControllerx = function () {
        "use strict";
        var fa = this.getDOMPosition(), ga = h.getViewportDimensions().height, ha = null;
        if (fa.y <= 0) {
            ha = fa.y;
        } else if (fa.y + fa.height < ga) {
            ha = 0;
        } else ha = fa.y + fa.height - ga;
        return {viewport_distance: ha, unit_height: fa.height};
    };
    ea.prototype.$VideoPlayerControllery = function () {
        "use strict";
        return ba(Object.assign({}, this.$VideoPlayerControllerx(), {ad_client_token: this.$VideoPlayerController3, autoplay_eligible: this.isAutoplayable(), autoplay_setting: this.$VideoPlayerController2, player_version: this.$VideoPlayerController4, video_id: this.getVideoID(), player_state: this.$VideoPlayerControllerz}), this.$VideoPlayerControllera.get());
    };
    ea.prototype.$VideoPlayerControllerA = function () {
        "use strict";
        if (this.isState('loading'))return null;
        return this.getVideoAPI().getVideoInfo();
    };
    ea.prototype.$VideoPlayerControlleri = function (fa) {
        "use strict";
        var ga = this.$VideoPlayerControllerA();
        if (ga != null)return ba({resource_url: ga.urlRequest.url, hls: ga.isHLS, hd: ga.isHD}, fa);
        return fa;
    };
    ea.prototype.logEvent = function (event, fa) {
        "use strict";
        var ga = ba(this.$VideoPlayerControllery(), fa);
        this.$VideoPlayerControllerd.logEvent(event, ga);
    };
    ea.prototype.setFTDataForCasablanca = function () {
        "use strict";
        if (this.isPlayerVersion(t.CASABLANCA)) {
            var fa = w(this.getRootNode(), ['ft']);
            this.getVideoAPI().setFTData(JSON.stringify(fa.ft));
        }
    };
    ea.prototype.setScriptPathForCasablanca = function () {
        "use strict";
        if (this.isPlayerVersion(t.CASABLANCA))this.getVideoAPI().setScriptPath(k.getScriptPath());
    };
    ea.prototype.setState = function (fa) {
        "use strict";
        if (this.isState('fallback'))return;
        this.$VideoPlayerControllerz = fa;
        if (this.$VideoPlayerControllerz === 'fallback')this.$VideoPlayerControllerk();
        this.emit('stateChange');
    };
    ea.prototype.isState = function (fa) {
        "use strict";
        return this.$VideoPlayerControllerz === fa;
    };
    ea.playerStates = ['finished', 'loading', 'paused', 'playing', 'ready', 'fallback'];
    e.exports = ea;
}, null);
__d("PhotoSnowlift", ["Arbiter", "Assert", "AsyncRequest", "Bootloader", "CSS", "Dialog", "DOM", "DOMControl", "Event", "fbt", "FullScreen", "ImageUtils", "Input", "Keys", "Layer", "LayerHideOnEscape", "LikeConfirmer", "LinkController", "LitestandStoryInsertionStatus", "Locale", "PageTransitions", "Parent", "PhotoLogger", "PhotoPermalinkURI", "PhotosConst", "PhotoSessionLog", "PhotosetPivotSlide.react", "PhotosetSearchPivot.react", "PhotosetSearchPivotData", "PhotoSnowliftAds", "PhotoStreamCache", "PhotosUtils", "PhotoTagSearchPivotLogger", "PhotoViewer", "React", "Rect", "ScriptPath", "ScrollableArea", "Style", "Toggler", "Tooltip", "UFIFeedbackTargets", "UIPagelet", "URI", "UserAgent_DEPRECATED", "Vector", "VideoPlayerController", "VideoPlayerReason", "$", "computeRelativeURI", "copyProperties", "createArrayFrom", "csx", "cx", "emptyFunction", "ge", "getActiveElement", "goURI", "tx", "userAction"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, aa, ba, ca, da, ea, fa, ga, ha, ia, ja, ka, la, ma, na, oa, pa, qa, ra, sa, ta, ua, va, wa, xa, ya, za, ab, bb, cb, db, eb, fb, gb, hb, ib, jb, kb, lb, mb, nb) {
    var ob = 74, pb = 75, qb = 70, rb = 76, sb = 315;
    for (var tb in na)if (na.hasOwnProperty(tb))vb[tb] = na[tb];
    var ub = na === null ? null : na.prototype;
    vb.prototype = Object.create(ub);
    vb.prototype.constructor = vb;
    vb.__superConstructor__ = na;
    function vb() {
        "use strict";
        na.call(this);
        this._seenTags = {};
        this._navCount = 0;
        this._isZoomOn = false;
    }

    vb.prototype.preload = function (wb, xb) {
        "use strict";
        j.loadModules(["PhotoTagger", "Live", "PhotoTagApproval", "PhotoTags", "TagTokenizer", "css:fb-photos-snowlift-fullscreen-css"], function (zb) {
            this.PhotoTagger = zb;
        }.bind(this));
        var yb = this.getImageSrc(xa(wb).getQueryData());
        if (yb)if (!this._log(yb))(new Image()).src = yb;
    };
    vb.prototype.bootstrap = function (wb, xb) {
        "use strict";
        if (wb && xa(wb).getQueryData().makeprofile)this.enableCropperOnInit = true;
        this.preload(wb, xb);
        if (this.closeDirty) {
            setTimeout(this.bootstrap.bind(this, wb, xb), 0);
            return;
        }
        ja.reset();
        this.resetUriStack = true;
        if (this.isOpen)if (this.openExplicitly) {
            this.closeCleanup();
            this.resetUriStack = false;
        } else return;
        this._dataFt = null;
        var yb = ba.byAttribute(xb, 'data-cursor');
        if (yb) {
            try {
                var ac = JSON.parse(yb.getAttribute('data-ft'));
                this._dataFt = {qid: ac.qid, mf_story_key: ac.mf_story_key};
            } catch (zb) {
            }
        } else try {
            yb = ba.byAttribute(xb, 'data-ad');
            var bc = JSON.parse(yb.getAttribute('data-ad'));
            this._dataFt = {ad_id: bc.adid};
        } catch (zb) {
        }
        this.ua = nb('snowlift', xb).uai('open');
        qa.openOverlayView('snowlift');
        this.returningToStart = false;
        this.loading && k.removeClass(this.loading, 'loading');
        if (xb) {
            k.addClass((this.loading = xb), 'loading');
            var cc = ba.byClass(xb, 'uiStreamStory') || ba.byClass(xb, "_5jmm");
            if (cc) {
                this.storyID = cc.id;
            } else {
                var dc = ba.byClass(xb, "_5b9c");
                if (dc)this.storyID = dc.getAttribute('data-ownerid');
            }
            this._updateContainerOwnerID();
            this.getThumbAndSize(xb);
        } else this.loading = null;
        g.inform('PhotoSnowlift.GO', wb, g.BEHAVIOR_STATE);
        this.loadFrameIfUninitialized();
    };
    vb.prototype._updateContainerOwnerID = function () {
        "use strict";
        if (this.container)if (this.storyID) {
            this.container.setAttribute('data-ownerid', this.storyID);
        } else this.container.removeAttribute('data-ownerid');
    };
    vb.prototype.setupFromSnowflake = function (wb, xb) {
        "use strict";
        this.extraClasses = wb;
        this.snowflake = true;
        this.firstInSet = xb;
        if (this.root) {
            k.addClass(this.root, "snowflake");
            this.extraClasses.forEach(function (yb) {
                k.addClass(this.root, yb);
            }, this);
        }
    };
    vb.prototype.getCurrentImageServerSizeDimensions = function () {
        "use strict";
        var wb = this.stream.getCurrentImageData();
        return wb.originalDimensions || wb.dimensions;
    };
    vb.prototype.getEventPrefix = function () {
        "use strict";
        return 'PhotoSnowlift';
    };
    vb.prototype.getRoot = function () {
        "use strict";
        return this.root;
    };
    vb.prototype.getSourceString = function () {
        "use strict";
        return 'snowlift';
    };
    vb.prototype.getViewerSource = function () {
        "use strict";
        return this.source;
    };
    vb.prototype.getViewerSet = function () {
        "use strict";
        return this.stream.getPhotoSet();
    };
    vb.prototype.getVersionConst = function () {
        "use strict";
        return ea.VIEWER_SNOWLIFT;
    };
    vb.prototype.getImage = function () {
        "use strict";
        return this.image;
    };
    vb.prototype.getImageId = function () {
        "use strict";
        return this.stream.getCursor();
    };
    vb.prototype.getRHCHeader = function () {
        "use strict";
        return this.rhcHeader;
    };
    vb.prototype.getRHCBody = function () {
        "use strict";
        return this.ufiForm;
    };
    vb.prototype.getRHCFooter = function () {
        "use strict";
        return this.rhcFooter;
    };
    vb.prototype.getLoadQuery = function () {
        "use strict";
        return this.loadQuery;
    };
    vb.prototype.getCurrentPhotoInfo = function () {
        "use strict";
        var wb = this.stream.getCurrentImageData();
        if (wb)return wb.info;
        return null;
    };
    vb.prototype.getOwnerId = function () {
        "use strict";
        var wb = this.stream.getCurrentImageData();
        if (wb)return wb.info.owner;
        return null;
    };
    vb.prototype.getThumbAndSize = function (wb) {
        "use strict";
        this.currentImageSize = null;
        this.thumbSrc = null;
        var xb = xa(wb.getAttribute('ajaxify')).getQueryData();
        if (!xb.size)return;
        var yb = za.deserialize(xb.size);
        if (!yb.x || !yb.y)return;
        this.currentImageSize = yb;
        if (wb.getAttribute('data-cropped'))return;
        var zb = m.scry(wb, 'img')[0], ac = m.scry(wb, 'i')[0], bc = ba.byAttribute(wb, 'data-size');
        this.shouldStretch = bc && this.currentImageSize && zb && bc.getAttribute('data-size') === "2" && this.currentImageSize.x > this.currentImageSize.y && this.currentImageSize.x <= vb.TIMELINE_STRETCH_WIDTH && zb.offsetWidth === vb.TIMELINE_STRETCH_WIDTH;
        var cc;
        if (zb) {
            cc = zb.src;
        } else if (ac) {
            cc = sa.get(ac, 'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/, '$1');
        } else return;
        this.thumbSrc = cc;
    };
    vb.prototype.loadFrameIfUninitialized = function () {
        "use strict";
        if (this.root)return;
        new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();
    };
    vb.prototype.init = function (wb, xb) {
        "use strict";
        this.init = ib;
        this._shouldLog = xb.photos_client_loading;
        this._logger = null;
        if (this._shouldLog)this._logger = new ca(ea.VIEWER_SNOWLIFT_STRING);
        this._showHover = xb.pivot_hover;
        this._showMorePhotos = xb.show_more_photos;
        this._extraSlidePivot = xb.extra_slide_pivot;
        fa.setEndMetrics(xb.pivot_end_metric);
        this.startingMousePos = null;
        this.haveLeftBufferRegion = false;
        this.showingTypeaheadSuggestions = false;
        this.fullscreen = q.isSupported();
        this.showOGVideos = xb.og_videos;
        this.resizeCommentsForAds = xb.resize_comments_for_ads;
        this.spotlight = wb;
        this.spotlight.subscribe('blur', function () {
            this.closingAction = fa.OUTSIDE;
        }.bind(this));
        this.spotlight.subscribe('beforehide', this.beforeCloseHandler.bind(this));
        this.spotlight.subscribe('hide', this.closeHandler.bind(this));
        this.spotlight.subscribe('key', this.keyHandler.bind(this));
        this.initializeNodes(this.spotlight.getRoot());
        ja.init(this.sideAdUnit, this, xb, this.adsDisplayedCallback.bind(this));
        this.inAdsDisplayedCallback = false;
        this.lastAdsHeight = 0;
        if (!this.subscription) {
            x.registerHandler(this.handleNavigateAway.bind(this));
            this.subscription = g.subscribe('PhotoSnowlift.GO', function (yb, zb) {
                this.openExplicitly = true;
                this.loading && k.removeClass(this.loading, 'loading');
                this.open(zb);
            }.bind(this));
        }
        this.transitionHandlerRegistered = false;
        this.returningToStart = false;
        aa.registerHandler(this.openHandler.bind(this));
        this.openHandlerRegistered = true;
        g.subscribe('PhotoTagApproval.HILITE_TAG', this.onHiliteTag.bind(this));
        g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX', this.onUpdateTagBox.bind(this));
        if (this.fullscreen)q.subscribe('changed', this.onFullScreenChange.bind(this));
        this.slideshowGk = xb.snowlift_slideshow;
        this.buttonTruncateGk = xb.snowlift_button_truncate;
        this._hasZoomCapability = this._hasZoomCapability && xb.www_panorama_viewer;
        this.allowIrrelevantRequests = !!xb.snowlift_allow_irrelevant_requests;
        if (this.snowflake) {
            k.addClass(this.root, "snowflake");
            this.extraClasses.forEach(function (yb) {
                k.addClass(this.root, yb);
            }, this);
        }
    };
    vb.prototype.onFullScreenChange = function () {
        "use strict";
        var wb = q.isFullScreen();
        k.conditionClass(document.body, 'fbPhotoSnowliftFullScreenMode', wb);
        if (wb) {
            if (!k.hasClass(this.root, 'fbPhotoSnowliftEditMode'))this.collapseRHC();
            var xb = this.stream.getCurrentImageData();
            if (xb && xb.url && this.image.src !== xb.url && this.shouldShowHiRes(xb))this.switchImage(xb.url);
            this.adjustForResize();
            this._conditionDisplayZoomButton();
        } else {
            this.uncollapseRHC();
            if (ya.chrome() && !k.hasClass(this.root, 'fbPhotoSnowliftEditMode'))this.page(0, false);
            g.inform('reflow');
        }
        ta.hide();
        if (this.cropper)this.cropper.resetPhoto();
    };
    vb.prototype.initializeNodes = function (wb) {
        "use strict";
        this.root = wb;
        this.container = m.find(wb, 'div.fbPhotoSnowliftContainer');
        this._updateContainerOwnerID();
        this.snowliftPopup = m.find(this.container, 'div.fbPhotoSnowliftPopup');
        this.rhc = m.find(this.snowliftPopup, 'div.rhc');
        this.rhcHeader = m.find(this.rhc, 'div.rhcHeader');
        this.rhcFooter = m.find(this.rhc, 'div.rhcFooter');
        this.ufiForm = m.find(this.rhc, 'form.fbPhotosSnowliftFeedbackForm');
        this.ufiInputContainer = m.find(this.rhc, 'div.fbPhotosSnowboxFeedbackInput');
        this.scroller = m.find(this.ufiForm, 'div.rhcScroller');
        this.scrollerBody = m.find(this.scroller, 'div.uiScrollableAreaBody');
        this.stageWrapper = m.find(this.snowliftPopup, 'div.stageWrapper');
        this.overlay = m.find(this.snowliftPopup, 'div.snowliftOverlay');
        this.errorBox = m.find(this.stageWrapper, 'div.stageError');
        this.image = m.find(this.stageWrapper, 'img.spotlight');
        this.stage = m.find(this.stageWrapper, 'div.stage');
        this.showZoomButton = m.scry(this.stageWrapper, "._10zt").pop();
        this.zoomedImage = m.scry(this.stage, "._10zw").pop();
        this.outerImageSlider = m.scry(this.stage, "._10zx").pop();
        this.innerImageSlider = m.scry(this.stage, "._10zv").pop();
        this.zoomOutSwitch = m.scry(this.stageWrapper, "._10zu").pop();
        this._hasZoomCapability = this.showZoomButton && this.zoomedImage && this.outerImageSlider && this.innerImageSlider && this.zoomOutSwitch;
        if (this._hasZoomCapability) {
            k.hide(this.showZoomButton);
            k.hide(this.zoomedImage);
            k.hide(this.outerImageSlider);
            k.hide(this.zoomOutSwitch);
        }
        this.videoStage = m.find(this.stageWrapper, 'div.videoStage');
        this.prevPager = m.find(this.snowliftPopup, 'a.snowliftPager.prev');
        this.nextPager = m.find(this.snowliftPopup, 'a.snowliftPager.next');
        this.stageActions = m.find(wb, 'div.stageActions');
        this.buttonActions = m.find(this.stageActions, 'div.fbPhotosPhotoButtons');
        this.placeInfo = m.find(this.rhc, 'div.fbPhotosSnowliftPlaceInfo');
        this.sideAdUnit = m.find(wb, "._5ciw");
        k.conditionClass(this.root, 'fullScreenAvailable', this.fullscreen);
    };
    vb.prototype.initializeScroller = function () {
        "use strict";
        this.initializeScroller = ib;
        this.scrollableArea = ra.fromNative(this.scroller, {fade: true, persistent: true});
        var wb = function (event) {
            var xb = o.$E(event).getTarget();
            if (m.contains(this.ufiInputContainer, xb)) {
                var yb = n.getInstance(xb);
                if (yb) {
                    this.scrollableArea.scrollToBottom();
                    var zb = yb.subscribe('resize', function () {
                        var bc = this.scrollableArea.isScrolledToBottom();
                        this.adjustScroller();
                        bc && this.scrollableArea.scrollToBottom();
                    }.bind(this)), ac = o.listen(xb, 'blur', function () {
                        yb.unsubscribe(zb);
                        ac.remove();
                    });
                }
            }
        }.bind(this);
        g.subscribe('ufi/changed', function (xb, yb) {
            if (this.ufiForm === yb.form)this.adjustScrollerIfNecessary();
        }.bind(this));
        g.subscribe('ufi/comment', function (xb, yb) {
            if (this.ufiForm === yb.form) {
                this.adjustScrollerIfNecessary();
                if (yb.isranked) {
                    this.scrollableArea.scrollToTop();
                } else this.scrollableArea.scrollToBottom();
            }
        }.bind(this));
        o.listen(this.rhc, 'click', function (event) {
            var xb = event.getTarget();
            if (ba.byTag(xb, 'a') || ba.byTag(xb, 'button') || m.isNodeOfType(xb, 'input'))this.adjustScrollerIfNecessary();
        }.bind(this));
        g.subscribe(['reflow', 'CommentUFI.Pager'], function () {
            if (this.isOpen)this.adjustScrollerIfNecessary();
        }.bind(this));
        o.listen(this.ufiForm, 'focusin', wb);
    };
    vb.prototype.openHandler = function (wb) {
        "use strict";
        if (this.isOpen || !da.isValid(wb) || this.returningToStart || wb.getQueryData().closeTheater || wb.getQueryData().permPage || wb.getQueryData().makeprofile) {
            this.openHandlerRegistered = false;
            return false;
        }
        this.open(wb);
        this._uriStack.push(xa(wb).getQualifiedURI().toString());
        aa.transitionComplete(true);
        return true;
    };
    vb.prototype.getImageSrc = function (wb) {
        "use strict";
        if (wb.smallsrc) {
            if (!wb.size)return wb.smallsrc;
            var xb = za.deserialize(wb.size), yb = this.getStageSize(xb);
            yb = this._adjustStageSizeForPixelRatio(yb);
            if (yb.x <= vb.STAGE_NORMAL_MAX.x && yb.y <= vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;
        }
        return wb.src;
    };
    vb.prototype.open = function (wb) {
        "use strict";
        var xb = xa(wb), yb = xb.getQueryData(), zb = da.parse(xb);
        if (zb !== null) {
            yb.fbid = zb.photo_id;
            yb.set = zb.set_token;
        }
        var ac = this.getImageSrc(yb);
        if (ac) {
            delete yb.src;
            delete yb.smallsrc;
        }
        if (this.resetUriStack)this._uriStack = [];
        if (!this.initialLoad) {
            yb.firstLoad = true;
            this.initialLoad = true;
            y.registerBlocker(function () {
                return this.isOpen;
            }.bind(this));
        }
        this.sessionID = Date.now();
        this.loadQuery = eb(yb, {ssid: this.sessionID});
        if (this._dataFt)this.loadQuery.data_ft = this._dataFt;
        this.isOpen = true;
        this.pagersShown = false;
        this.refreshOnClose = false;
        this.hilitedTag = null;
        this.loadingStates = {image: false, html: false};
        this.replaceUrl = false;
        this.movementDelta = 0;
        this.source = null;
        this.saveTagSubscription = g.subscribe('PhotoTagger.SAVE_TAG', this.onTagSaved.bind(this));
        this.taggedPhotoIds = [];
        this.stream = new ka();
        this.stream.init(ea.VIEWER_SNOWLIFT, 'PhotoViewerPagelet', 'pagelet_photo_viewer', this._shouldLog ? this._logger : null, yb.tagSuggestionMode || 'everyone');
        if (!!xa.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(xa.getMostRecentURI().getQueryData().viewas + '');
        this.fetchInitialData();
        this.setLoadingState(vb.STATE_HTML, true);
        this.rhcCollapsed = false;
        this._open(wb, ac);
        j.loadModules(["SnowliftPicCropper"], function (bc) {
            this.cropper = bc.getInstance(this);
            this.cropper.init();
            if (this.enableCropperOnInit) {
                var cc = g.subscribe('PhotoSnowlift.SWITCH_IMAGE', function () {
                    this.cropper.enableCropping();
                    g.unsubscribe(cc);
                }.bind(this));
                this.enableCropperOnInit = false;
            }
        }.bind(this));
        j.loadModules(["PhotosButtonTooltips"], function (bc) {
            bc.init();
        });
    };
    vb.prototype._open = function (wb, xb) {
        "use strict";
        this.createLoader(xb);
        this.spotlight.show();
        this.ua && this.ua.add_event('frame');
        g.inform('layer_shown', {type: 'PhotoSnowlift'});
        g.inform('PhotoSnowlift.OPEN');
        this.stageHandlers = [o.listen(window, 'resize', this.adjustForResize.bind(this)), o.listen(this.stageWrapper, 'click', this.buttonListener.bind(this)), o.listen(this.stageWrapper, 'mouseleave', function (event) {
            var ac = event.getTarget();
            if (!(ba.byClass(ac, 'snowliftOverlay') || ba.byClass(ac, 'fbPhotoSnowliftTagApproval') || ba.byClass(ac, 'tagPointer') || ba.byClass(ac, 'arrow') || ba.byClass(ac, 'faceboxSuggestion') || ba.byClass(ac, 'typeaheadWrapper') || ba.byClass(ac, 'photoTagTypeahead') || ba.byClass(ac, 'fbPhotoTagger')))this.unhiliteAllTags();
            this.hidePagers();
        }.bind(this)), o.listen(this.stageWrapper, 'mousemove', this.hilitePager.bind(this)), o.listen(this.stageWrapper, 'mousemove', this.hiliteTagsOnMouseMove.bind(this)), o.listen(this.overlay, 'mouseenter', this.unhiliteAllTags.bind(this)), o.listen(this.container, 'mousemove', this._enableMouseOver.bind(this)), o.listen(this.container, 'mouseover', this._interceptMouseOver.bind(this)), o.listen(this.stageWrapper, 'focusin', this.hilitePager.bind(this)), o.listen(this.rhc, 'focusin', this.hidePagers.bind(this))];
        if (this._hasZoomCapability) {
            this.stageHandlers.push(o.listen(this.stage, 'mousedown', this._zoomedImageMouseDown.bind(this)));
            this.stageHandlers.push(o.listen(this.root, 'mouseup', this._zoomedImageMouseUp.bind(this)));
        }
        this.stageHandlers.push(o.listen(this.container, 'click', function (event) {
            var ac = event.getTarget();
            if (ba.byClass(ac, 'rotateRight')) {
                this.rotate('right');
            } else if (ba.byClass(ac, 'rotateLeft')) {
                this.rotate('left');
            } else if (ba.byClass(ac, 'closeTheater')) {
                if (q.isFullScreen()) {
                    q.toggleFullScreen();
                    return;
                }
                this.closingAction = fa.X;
                this.spotlight.hide();
                return false;
            } else if (this.fullscreen)if (ba.byClass(ac, 'fbPhotoSnowliftFullScreen')) {
                this.toggleFullScreen();
            } else if (ba.byClass(ac, 'fbPhotoSnowliftCollapse'))this.toggleCollapse();
        }.bind(this)));
        var yb = jb('fbPhotoSnowliftFeedback');
        if (yb)this.stageHandlers.push(o.listen(yb, 'click', function (event) {
            var ac = event.getTarget();
            if (ba.byClass(ac, 'like_link') || (ba.byClass(ac, 'UFILikeLink') && ba.byClass(ac, 'UIActionLinks')))this.toggleLikeButton();
            var bc = ba.byClass(event.getTarget(), 'uiUfiCollapsedComment');
            if (bc)k.addClass(bc, 'uiUfiCollapsedCommentToggle');
        }.bind(this)));
        var zb = jb('fbPhotoSnowliftOnProfile');
        if (zb)this.stageHandlers.push(o.listen(zb, 'click', function (event) {
            if (ba.byClass(event.getTarget(), 'fbPhotoRemoveFromProfileLink'))this.refreshOnClose = true;
        }.bind(this)));
        if (this.resetUriStack)this.startingURI = xa.getMostRecentURI().addQueryData({closeTheater: 1}).getUnqualifiedURI();
        if (!xb)this.setLoadingState(vb.STATE_IMAGE_DATA, true);
        if (!this.transitionHandlerRegistered) {
            aa.registerHandler(this.transitionHandler.bind(this));
            this.transitionHandlerRegistered = true;
        }
        fa.initLogging(fa.SNOWLIFT);
        if (this.pivots)fa.setRelevantCount(this.pivots.relevantCount);
    };
    vb.prototype.toggleFullScreen = function () {
        "use strict";
        var wb = q.toggleFullScreen(document.documentElement);
        if (wb) {
            var xb = this.stream.getCurrentImageData();
            if (xb && xb.url && this.image.src !== xb.url && this.shouldShowHiRes(xb))if (!this._log(xb.url))(new Image()).src = xb.url;
            if (this._isZoomOn) {
                this._setZoomOut();
                k.show(this.image);
            }
            fa.logEnterFullScreen(this.stream.getCursor());
        }
    };
    vb.prototype.getStream = function () {
        "use strict";
        return this.stream;
    };
    vb.prototype.fetchInitialData = function () {
        "use strict";
        this.ua && this.ua.add_event('init_data');
        this.stream.waitForInitData();
        wa.loadFromEndpoint('PhotoViewerInitPagelet', jb('pagelet_photo_viewer_init', this.root), this.loadQuery, {actorID: va.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid), usePipe: true, jsNonblock: true, crossPage: true, allowIrrelevantRequests: this.allowIrrelevantRequests});
    };
    vb.prototype.toggleCollapse = function () {
        "use strict";
        if (this.rhcCollapsed) {
            this.uncollapseRHC();
        } else this.collapseRHC();
    };
    vb.prototype.collapseRHC = function () {
        "use strict";
        this.rhcCollapsed = true;
        k.addClass(this.root, 'collapseRHC');
        this.adjustForResize();
    };
    vb.prototype.uncollapseRHC = function () {
        "use strict";
        this.rhcCollapsed = false;
        k.removeClass(this.root, 'collapseRHC');
        this.adjustForResize();
    };
    vb.prototype.beforeCloseHandler = function () {
        "use strict";
        if (this.isOpen && this.cropper && this.cropper.croppingMode) {
            this.warnLeavePage(this.closeHandler.bind(this));
            return false;
        }
    };
    vb.prototype.closeHandler = function () {
        "use strict";
        if (!this.isOpen)return;
        this.closingAction = this.closingAction || fa.ESC;
        if (xa.getMostRecentURI().addQueryData({closeTheater: 1}).getUnqualifiedURI().toString() == this.startingURI.toString()) {
            this.close();
            return;
        }
        this.returnToStartingURI(this.refreshOnClose);
        this.close();
    };
    vb.prototype.returnToStartingURI = function (wb, xb) {
        "use strict";
        if (!wb)if (xb) {
            this.squashNextTransition(lb.bind(null, xb));
        } else this.squashNextTransition();
        this.returningToStart = true;
        var yb = g.subscribe('page_transition', (function () {
            this.returningToStart = false;
            yb.unsubscribe();
        }).bind(this)), zb = wb || isNaN(ya.opera()), ac = this._uriStack.length;
        if (zb && ac < window.history.length) {
            window.history.go(-ac);
        } else {
            var bc = this.startingURI, cc = new xa(bc).removeQueryData('closeTheater');
            if (bc.getQueryData().sk == 'approve' && bc.getPath() == '/profile.php') {
                cc.removeQueryData('highlight');
                cc.removeQueryData('notif_t');
            }
            lb(cc);
        }
    };
    vb.prototype.squashNextTransition = function (wb) {
        "use strict";
        this.squashNext = true;
        aa.registerHandler(function xb() {
            if (this.squashNext) {
                this.squashNext = false;
                if (wb)setTimeout(wb, 0);
                aa.transitionComplete(true);
                return true;
            }
            return false;
        }.bind(this), 7);
    };
    vb.prototype.handleNavigateAway = function (wb) {
        "use strict";
        var xb = db(aa._most_recent_uri.getQualifiedURI(), wb.getAttribute('href'));
        if (this.isOpen && (xb instanceof xa) && xb.getUnqualifiedURI().toString() != this.startingURI.toString() && xb.getPath() != '/photo.php') {
            if (!this.closingAction)this.closingAction = fa.NAVIGATE;
            this.returnToStartingURI(false, xb);
            this.close();
            return false;
        }
        return true;
    };
    vb.prototype.postProcessTaggedPhotos = function () {
        "use strict";
        if (this.taggedPhotoIds && this.taggedPhotoIds.length > 0) {
            var wb = null;
            if (this.source === vb.COLLECTIONS_UNTAGGED_PHOTOS) {
                wb = '/ajax/photos/photo/edit/skiptag/';
            } else if (this.source === vb.PHOTOS_OF_YOU_SUGGESTIONS || this.source === vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb = '/ajax/photos/photo/add_to_star_grid/';
            if (wb)new i().setURI(wb).setAllowCrossPageTransition(true).setData({media_id: this.taggedPhotoIds, source: this.source}).send();
        }
    };
    vb.prototype.onTagSaved = function (wb, xb) {
        "use strict";
        if (this.taggedPhotoIds) {
            if (this.source === vb.PHOTOS_OF_YOU_SUGGESTIONS && !xb.self_tag)return;
            this.taggedPhotoIds.push(xb.photo_fbid);
        }
    };
    vb.prototype.close = function () {
        "use strict";
        if (!this.isOpen)return;
        this.hideMorePhotos();
        this._pauseVideoIfNeeded();
        this.isOpen = false;
        this._navCount = 0;
        if (this.fullscreen)q.disableFullScreen();
        nb('snowlift').uai('close');
        qa.closeOverlayView('snowlift');
        this.cropper && this.cropper.disableCropping();
        this.spotlight.hide();
        this.openExplicitly = false;
        this.postProcessTaggedPhotos();
        g.unsubscribe(this.saveTagSubscription);
        this.taggedPhotoIds = [];
        this.closeDirty = true;
        setTimeout(this.closeCleanup.bind(this), 0);
        if (this.snowflake) {
            k.removeClass(this.root, "snowflake");
            this.extraClasses.forEach(function (wb) {
                k.removeClass(this.root, wb);
            }, this);
        }
        this.extraClasses = [];
        this.snowflake = false;
        this.firstInSet = null;
        this.movementDelta = 0;
    };
    vb.prototype.closeCleanup = function () {
        "use strict";
        this.closeDirty = false;
        k.removeClass(this.root, 'dataLoading');
        fa.logPhotoViews(this.closingAction);
        this.destroy();
        k.hide(this.errorBox);
        k.hide(this.image);
        this.currentImageSize = null;
        this.thumbSrc = null;
        this.shouldStretch = false;
        this.resetUriStack = true;
        var wb = this.stream.getCursor();
        k.removeClass(this.stageWrapper, 'showVideo');
        m.empty(this.videoStage);
        this.uncollapseRHC();
        this.currentMinSize = null;
        this.setStagePagersState('reset');
        this.recacheData();
        m.empty(this.sideAdUnit);
        this.stream.destroy();
        this.root.setAttribute('aria-busy', 'true');
        var xb = this.closingAction === fa.NAVIGATE;
        this.closingAction = null;
        if (!this.openHandlerRegistered) {
            aa.registerHandler(this.openHandler.bind(this));
            this.openHandlerRegistered = true;
        }
        g.inform('layer_hidden', {type: 'PhotoSnowlift'});
        g.inform('PhotoSnowlift.CLOSE', {is_navigating: xb, fbid: wb});
        this._setZoomOut();
    };
    vb.prototype.createLoader = function (wb) {
        "use strict";
        if (this.currentImageSize === null) {
            this.adjustStageSize(vb.STAGE_MIN);
        } else {
            var xb = this.getStageSize(this.currentImageSize);
            xb = new za(Math.max(xb.x, vb.STAGE_MIN.x), Math.max(xb.y, vb.STAGE_MIN.y));
            var yb = this.getImageSizeInStage(this.currentImageSize, xb);
            if (this.thumbSrc === null) {
                this.adjustStageSize(yb);
            } else this.useImage(m.create('img', {className: 'spotlight', alt: '', src: this.thumbSrc, style: {width: yb.x + 'px', height: yb.y + 'px'}}), yb, false);
        }
        this.setLoadingState(this.STATE_IMAGE_PIXELS, true);
        if (wb)setTimeout((function () {
            var zb = new Image(), ac = function () {
                if (!this.isOpen)return;
                if (!this.stream || !this.stream.errorInCurrent()) {
                    this.switchImage(wb, this.currentImageSize);
                    this.ua && this.ua.add_event('image');
                    this.setLoadingState(vb.STATE_IMAGE_DATA, false);
                }
            }.bind(this), bc = o.listen(zb, 'load', ac), cc = function () {
                if (bc) {
                    bc.remove();
                    bc = null;
                }
            };
            g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE', cc);
            g.subscribeOnce('PhotoSnowlift.CLOSE', cc);
            this._log(wb);
            zb.src = wb;
        }).bind(this), 0);
        k.hide(this.stageActions);
        this.setStagePagersState('disabled');
    };
    vb.prototype.initDataFetched = function (wb) {
        "use strict";
        fa.setPhotoSet(this.stream.getPhotoSet());
        fa.setLogFbids(wb.logids);
        var xb = this.stream.getCurrentImageData();
        fa.addPhotoView(xb.info, this.shouldShowHiRes(xb), this.fullscreen && q.isFullScreen());
        var yb = this.stream.getCurrentExtraData();
        if (this._showHover && yb)ma.logImageImpression('snowlift', String(this.stream.getCursor()), Object.keys(yb.tagRects));
        if (yb && yb.source !== undefined) {
            this.source = parseInt(yb.source, 10);
            fa.setSource(this.source);
        }
        if (!this.pageHandlers)this.pageHandlers = [o.listen(this.root, 'click', this.pageListener.bind(this)), o.listen(this.root, 'mouseleave', this.mouseLeaveListener.bind(this))];
        k.show(this.stageActions);
        this.root.setAttribute('aria-busy', 'false');
        this.isLoggedInViewer = wb.loggedin;
        this.disableAds = !this.isLoggedInViewer || wb.fromad || this.stream.isInViewAsMode();
        this.loadAds();
        var zb = new za(this.stage.clientWidth, this.stage.clientHeight);
        if (xb && this._shouldShowZoomButton(zb, xb.originalDimensions)) {
            fa.addPanoramaImpression();
            this._displayZoomButton(zb);
        } else if (this._hasZoomCapability)k.hide(this.showZoomButton);
    };
    vb.prototype.adjustScrollerIfNecessary = function () {
        "use strict";
        clearTimeout(this.scrollerTimeout);
        this.scrollerTimeout = setTimeout(this.adjustScroller.bind(this), 0);
    };
    vb.prototype.adjustScroller = function (wb) {
        "use strict";
        clearTimeout(this.scrollerTimeout);
        this.initializeScroller();
        this.scrollableArea.resize();
        var xb = za.getElementDimensions(this.rhc), yb = xb.y;
        yb -= za.getElementDimensions(this.rhcHeader).y;
        yb -= za.getElementDimensions(this.ufiInputContainer).y;
        if (this.placeInfo) {
            var zb = za.getElementDimensions(this.placeInfo);
            yb -= zb.y;
            sa.set(this.sideAdUnit, 'bottom', zb.y + 'px');
        }
        if (wb == null)wb = this.resizeCommentsForAds ? this.lastAdsHeight : 0;
        this.lastAdsHeight = wb;
        yb = Math.max(0, yb);
        var ac = za.getElementDimensions(this.scrollerBody).y, bc = Math.max(vb.MIN_UFI_HEIGHT, yb - wb);
        if (ac >= bc) {
            if (yb > bc) {
                k.removeClass(this.rhc, 'pinnedUfi');
                yb -= bc;
            } else {
                k.addClass(this.rhc, 'pinnedUfi');
                yb = 0;
            }
            sa.set(this.scroller, 'height', bc + 'px');
        } else {
            sa.set(this.scroller, 'height', 'auto');
            k.removeClass(this.rhc, 'pinnedUfi');
            yb -= ac;
        }
        var cc = za.getElementDimensions(this.ufiInputContainer).y;
        sa.set(this.ufiForm, 'padding-bottom', cc + 'px');
        ja.resize(new za(xb.x, yb));
        this.scrollableArea.adjustGripper();
    };
    vb.prototype.adjustForResize = function () {
        "use strict";
        this.currentMinSize = null;
        this.adjustStageSize();
        this.adjustForNewData();
        if (this._hasZoomCapability) {
            if (!this._isZoomOn)this._conditionDisplayZoomButton();
            this._repositionZoomedImageOnResize();
        }
    };
    vb.prototype.shouldShowHiRes = function (wb) {
        "use strict";
        if (!wb || !wb.smallurl)return false;
        var xb = this.getStageSize(wb.dimensions);
        xb = this._adjustStageSizeForPixelRatio(xb);
        var yb = this.getImageSizeInStage(wb.dimensions, xb);
        return (yb.x > vb.STAGE_NORMAL_MAX.x || yb.y > vb.STAGE_NORMAL_MAX.y);
    };
    vb.prototype._adjustStageSizeForPixelRatio = function (wb) {
        "use strict";
        if (window.devicePixelRatio && window.devicePixelRatio > 1)wb = new za(wb.x * window.devicePixelRatio, wb.y * window.devicePixelRatio);
        return wb;
    };
    vb.prototype.getImageURL = function (wb) {
        "use strict";
        if (wb.video) {
            return null;
        } else if (wb.smallurl && !this.shouldShowHiRes(wb))return wb.smallurl;
        return wb.url;
    };
    vb.prototype.getImageDimensions = function (wb) {
        "use strict";
        if (this._isZoomOn)return wb.originalDimensions;
        if (wb.smalldims && (!this.shouldShowHiRes(wb) || this.image.src === wb.smallurl))return wb.smalldims;
        return wb.dimensions;
    };
    vb.prototype.getStageSize = function (wb, xb) {
        "use strict";
        var yb = za.getViewportDimensions(), zb = new za(wb.x, wb.y);
        if (xb)zb = new za(Math.max(wb.x, xb.x), Math.max(wb.y, xb.y));
        var ac, bc;
        if (this.fullscreen && q.isFullScreen()) {
            return new za((this.rhcCollapsed ? screen.width : screen.width - vb.SIDEBAR_SIZE_MAX), screen.height - vb.FULL_SCREEN_PADDING * 2);
        } else {
            ac = Math.min(zb.x, (yb.x - vb.SIDEBAR_SIZE_MAX - vb.STAGE_CHROME.x));
            bc = Math.min(zb.y, yb.y - vb.STAGE_CHROME.y);
        }
        if (ac === 0 && bc === 0)return new za(0, 0);
        var cc = ac / bc, dc = zb.x / zb.y;
        if (cc < dc)return new za(ac, Math.round(ac / dc));
        return new za(Math.round(bc * dc), bc);
    };
    vb.prototype.getImageSizeInStage = function (wb, xb) {
        "use strict";
        var yb = wb.x, zb = wb.y;
        if (yb >= xb.x || zb >= xb.y) {
            var ac = xb.x / xb.y, bc = yb / zb;
            if (ac < bc) {
                yb = xb.x;
                zb = Math.round(yb / bc);
            } else if (ac > bc) {
                zb = xb.y;
                yb = Math.round(zb * bc);
            } else {
                yb = xb.x;
                zb = xb.y;
            }
        }
        return new za(yb, zb);
    };
    vb.prototype.getStageSizeForZoomedImage = function (wb, xb) {
        "use strict";
        if (this.fullscreen && q.isFullScreen()) {
            var yb = this.rhcCollapsed ? screen.width : screen.width - vb.SIDEBAR_SIZE_MAX, zb = screen.height - vb.FULL_SCREEN_PADDING * 2;
            return new za(yb, zb);
        }
        var ac = za.getViewportDimensions();
        if (xb === null)xb = new za(0, 0);
        var bc = new za(Math.max(wb.x, vb.STAGE_MIN.x, xb.x), Math.max(wb.y, vb.STAGE_MIN.y, xb.y)), cc = ac.x - vb.STAGE_CHROME.x;
        if (!this.rhcCollapsed)cc -= vb.SIDEBAR_SIZE_MAX;
        yb = Math.min(bc.x, cc);
        zb = Math.min(bc.y, ac.y - vb.STAGE_CHROME.y);
        return new za(yb, zb);
    };
    vb.prototype.adjustStageSize = function (wb) {
        "use strict";
        var xb = this.currentImageSize;
        if (wb) {
            xb = wb;
        } else {
            var yb = this.stream && this.stream.getCurrentImageData();
            if (yb)xb = this.getImageDimensions(yb);
        }
        if (!xb)return;
        this.currentImageSize = xb;
        var zb = 0;
        if (this.shouldStretch && !this.getVideoOnStage() && xb.x > xb.y && xb.x <= vb.TIMELINE_STRETCH_WIDTH && xb.x >= vb.TIMELINE_STRETCH_MIN) {
            xb.y = Math.round(xb.y * vb.TIMELINE_STRETCH_WIDTH / xb.x);
            xb.x = vb.TIMELINE_STRETCH_WIDTH;
        } else if (this.getVideoOnStage())zb = vb.VIDEO_BOTTOM_BAR_SPACE * 2;
        var ac;
        if (this._isZoomOn) {
            ac = this.getStageSizeForZoomedImage(xb, this.currentMinSize);
        } else ac = this.getStageSize(xb, this.currentMinSize);
        if (!this.currentMinSize)this.currentMinSize = new za(0, 0);
        this.currentMinSize = new za(Math.max(ac.x, vb.STAGE_MIN.x, this.currentMinSize.x), Math.max(ac.y, vb.STAGE_MIN.y, this.currentMinSize.y));
        var bc = this.getImageSizeInStage(xb, this.currentMinSize), cc = this.currentMinSize.x - bc.x, dc = this.currentMinSize.y - bc.y;
        if (cc > 0 && cc < vb.PADDING_MIN) {
            this.currentMinSize.x -= cc;
        } else if (dc > 0 && dc < vb.PADDING_MIN)this.currentMinSize.y -= dc;
        var ec = this.currentMinSize.x + vb.SIDEBAR_SIZE_MAX;
        if (this.rhcCollapsed)ec = this.currentMinSize.x;
        this.snowliftPopup.style.cssText = 'width:' + ec + 'px;' + 'height:' + this.currentMinSize.y + 'px;';
        var fc = this.currentMinSize.y - zb + 'px';
        if (ya.firefox()) {
            var gc = sa.get(this.stageWrapper, 'font-size');
            fc = ((this.currentMinSize.y - zb) / parseFloat(gc)) + 'em';
        }
        this.stageWrapper.style.cssText = 'width:' + this.currentMinSize.x + 'px;' + 'line-height:' + fc + ';';
        if (this._isZoomOn) {
            var hc = this.currentMinSize.y - zb;
            if (xb.y > hc) {
                var ic = (xb.x / xb.y) * hc;
                sa.apply(this.zoomedImage, {width: ic + "px", height: hc + "px"});
            } else sa.apply(this.zoomedImage, {width: xb.x + "px", height: xb.y + "px"});
        } else this.image.style.cssText = 'width:' + bc.x + 'px;' + 'height:' + bc.y + 'px;';
        var jc = this.getTagger();
        if (jc)jc.repositionTagger();
        this.adjustScrollerIfNecessary();
    };
    vb.prototype.adjustForNewData = function () {
        "use strict";
        if (!this.image)return;
        var wb = m.scry(this.stage, 'div.tagsWrapper')[0], xb = za.getElementDimensions(this.image);
        if (wb) {
            sa.set(wb, 'width', xb.x + 'px');
            sa.set(wb, 'height', xb.y + 'px');
        }
    };
    vb.prototype.adsDisplayedCallback = function (wb, xb) {
        "use strict";
        var yb = this.resizeCommentsForAds && !this.inAdsDisplayedCallback && !this.disableAds && wb < vb.MIN_ADS_VISIBLE && xb.length >= vb.MIN_ADS_VISIBLE;
        if (yb) {
            this.inAdsDisplayedCallback = true;
            var zb = xb[vb.MIN_ADS_VISIBLE - 1];
            this.adjustScroller(zb);
            this.inAdsDisplayedCallback = false;
        }
    };
    vb.prototype.setLoadingState = function (wb, xb) {
        "use strict";
        switch (wb) {
            case vb.STATE_IMAGE_PIXELS:
                k.conditionClass(this.root, 'imagePixelsLoading', xb);
                break;
            case vb.STATE_IMAGE_DATA:
                this.loadingStates[wb] = xb;
                k.conditionClass(this.root, 'imageLoading', xb);
                break;
            case vb.STATE_HTML:
                this.loadingStates[wb] = xb;
                k.conditionClass(this.root, 'dataLoading', xb);
                this.rhc.setAttribute('aria-busy', xb ? 'true' : 'false');
                break;
        }
    };
    vb.prototype.destroy = function () {
        "use strict";
        this.stageHandlers.forEach(function (wb) {
            wb.remove();
        });
        if (this.pageHandlers) {
            this.pageHandlers.forEach(function (wb) {
                wb.remove();
            });
            this.pageHandlers = null;
        }
        this._slideshowToken && clearInterval(this._slideshowToken);
        this._slideshowToken = null;
        this._videoPlayerStateManager = null;
    };
    vb.prototype.checkState = function (wb) {
        "use strict";
        if (wb != vb.STATE_ERROR && !this.loadingStates[wb])return;
        switch (wb) {
            case vb.STATE_IMAGE_DATA:
                var xb = this.stream.getCurrentImageData();
                if (xb) {
                    var yb = this.getImageURL(xb);
                    if (yb) {
                        this.switchImage(yb, null, true);
                    } else if (xb.video)this.switchVideo(xb.video, xb.info, true);
                    this.setLoadingState(wb, false);
                }
                break;
            case vb.STATE_HTML:
                if (this.stream.getCurrentHtml()) {
                    this.swapData();
                    this.setLoadingState(wb, false);
                }
                break;
            default:
                if (this.stream.errorInCurrent()) {
                    k.hide(this.image);
                    k.show(this.errorBox);
                }
                break;
        }
    };
    vb.prototype.buttonListener = function (event) {
        "use strict";
        var wb = event.getTarget(), xb = Date.now();
        if (ba.byClass(wb, "_10zt")) {
            fa.addPanoramaClick();
            this.switchIntoZoomedImage();
            return;
        }
        if (ba.byClass(wb, "_10zu")) {
            this._setZoomOut();
            this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));
            return;
        }
        if (ba.byClass(wb, 'fbPhotoTagApprovalBox'))return;
        if (xb - this.lastPage < 350)return;
        if (ba.byClass(wb, 'fbPhotosPhotoLike')) {
            this.likePhoto();
        } else if (ba.byClass(wb, 'tagApproveIgnore')) {
            this.updateTagBox(event, wb);
        } else if (ba.byClass(wb, "_5ge9")) {
            this.hideMorePhotos();
            this.toggleSlideshow();
            return false;
        } else if (ba.byClass(wb, "_5ymu")) {
            if (!this._showingMorePhotos) {
                ma.logShowMorePhotos();
                var yb = this.stream.getCursor();
                if (yb)this.showMorePhotos(String(yb));
                if (this._hasZoomCapability)k.hide(this.showZoomButton);
            } else {
                ma.logHideMorePhotos();
                this._conditionDisplayZoomButton();
                this.hideMorePhotos();
            }
            return;
        } else if (ba.byClass(wb, "_27n"))this._conditionDisplayZoomButton();
        this.hideMorePhotos();
    };
    vb.prototype.toggleSlideshow = function () {
        "use strict";
        if (!this.slideshowGk)return;
        if (this._slideshowToken) {
            this.stopSlideshow();
        } else this.startSlideshow();
    };
    vb.prototype.startSlideshow = function () {
        "use strict";
        this._slideshowToken = window.setInterval(this.page.bind(this, 1, ya.chrome() && q.isFullScreen()), vb.SLIDESHOW_TIME);
        k.addClass(this.root, 'slideshowStarted');
        k.removeClass(this.root, 'slideshowAvailable');
    };
    vb.prototype.stopSlideshow = function () {
        "use strict";
        this._slideshowToken && clearInterval(this._slideshowToken);
        this._slideshowToken = null;
        k.addClass(this.root, 'slideshowAvailable');
        k.removeClass(this.root, 'slideshowStarted');
    };
    vb.prototype.likePhoto = function () {
        "use strict";
        fa.addButtonLike();
        var wb = cb('fbPhotoSnowliftFeedback'), xb = m.scry(wb, 'button.like_link')[0];
        if (!xb)xb = m.scry(wb, 'a.UFILikeLink')[0];
        var yb = xb.getAttribute('href');
        if (q.isFullScreen())if (ya.chrome())xb.setAttribute('href', 'javascript:;');
        xb.click();
        xb.setAttribute('href', yb);
    };
    vb.prototype.toggleLikeButton = function () {
        "use strict";
        var wb = m.scry(this.buttonActions, 'a.fbPhotosPhotoLike')[0];
        if (wb) {
            var xb = m.find(this.root, '.likeCount'), yb = m.find(xb, '.likeCountNum');
            if (xb)if (k.hasClass(wb, 'viewerLikesThis')) {
                m.setContent(yb, parseInt(yb.textContent, 10) - 1);
            } else m.setContent(yb, parseInt(yb.textContent, 10) + 1);
            k.toggleClass(wb, 'viewerLikesThis');
            k.removeClass(wb, 'viewerAlreadyLikedThis');
        }
    };
    vb.prototype.likePhotoWithKey = function () {
        "use strict";
        return w.like(this.likePhoto.bind(this), kb());
    };
    vb.prototype.updateTagBox = function (wb, xb) {
        "use strict";
        this.unhiliteAllTags();
        var yb = jb(wb);
        if (!yb)return;
        k.addClass(yb, 'tagBox');
        k.addClass(yb, 'tagBoxPendingResponse');
        k.removeClass(yb, 'tagBoxPending');
        k.hide(m.find(yb, 'span.tagForm'));
        if (xb) {
            k.show(m.find(yb, 'span.tagApproved'));
        } else k.show(m.find(yb, 'span.tagIgnored'));
    };
    vb.prototype.rotate = function (wb) {
        "use strict";
        var xb = this.stream.getCursor();
        if (this.getVideoOnStage()) {
            var yb = (wb == 'left') ? 270 : 90;
            h.isTruthy(this.videoRotateURI, "Video rotate URI not set.");
            j.loadModules(["VideoRotate"], function (ac) {
                new ac(xb, this.videoRotateURI).motionRotate(yb);
            }.bind(this));
            return;
        }
        var zb = eb({fbid: xb, opaquecursor: this.stream.getOpaqueCursor(xb), cs_ver: ea.VIEWER_SNOWLIFT}, this.stream.getPhotoSetQuery());
        zb[wb] = 1;
        this.setLoadingState(vb.STATE_IMAGE_DATA, true);
        this.setLoadingState(this.STATE_IMAGE_PIXELS, true);
        k.hide(this.image);
        new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this, xb)).setFinallyHandler(this.rotationComplete.bind(this, xb)).setMethod('POST').setReadOnly(false).send();
    };
    vb.prototype.rotationComplete = function (wb, xb) {
        "use strict";
        if (wb == this.stream.getCursor()) {
            this.setLoadingState(vb.STATE_IMAGE_DATA, false);
            this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));
            this.swapData();
        }
    };
    vb.prototype.rotationError = function (wb, xb) {
        "use strict";
        if (wb == this.stream.getCursor()) {
            this.setLoadingState(vb.STATE_IMAGE_DATA, false);
            this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));
            j.loadModules(["AsyncResponse"], function (yb) {
                yb.defaultErrorHandler(xb);
            });
        }
    };
    vb.prototype.saveTagsFromPayload = function (wb) {
        "use strict";
        this.storeFromData(wb);
        if ('data' in wb && this.stream.getCursor() in wb.data)this.swapData();
    };
    vb.prototype.saveEdit = function () {
        "use strict";
        if (!k.hasClass(this.root, 'fbPhotoSnowliftEditMode'))return;
        j.loadModules(["PhotoInlineEditor", "Form"], function (wb, xb) {
            var yb = wb.getInstance(this.getViewerConst());
            yb && xb.bootstrap(yb.getForm().controller);
        }.bind(this));
    };
    vb.prototype.mouseLeaveListener = function (event) {
        "use strict";
        this.unhiliteAllTags();
        this.reHilitePendingTag();
    };
    vb.prototype.hilitePager = function (event) {
        "use strict";
        var wb = za.getEventPosition(event), xb = za.getElementPosition(this.stage);
        if (z.isRTL()) {
            var yb = za.getElementDimensions(this.stage);
            this.stagePagerPrev = yb.x - (wb.x - xb.x) < vb.GOPREV_AREA;
        } else this.stagePagerPrev = wb.x - xb.x < vb.GOPREV_AREA;
        k.conditionClass(this.prevPager, 'hilightPager', this.stagePagerPrev);
        k.conditionClass(this.nextPager, 'hilightPager', !this.stagePagerPrev);
        var zb, ac = event.getTarget();
        if (!ba.byClass(ac, 'snowliftOverlay') && !ba.byClass(ac, 'bottomBarActions') && !ba.byClass(ac, 'snowliftPager'))zb = vb.PAGER_FADE;
        this.showPagers(zb);
    };
    vb.prototype.showPagers = function (wb) {
        "use strict";
        clearTimeout(this.fadePagerTimer);
        this.setStagePagersState('active');
        if (typeof wb !== 'undefined')this.fadePagerTimer = setTimeout(this.hidePagers.bind(this), wb);
    };
    vb.prototype.hidePagers = function () {
        "use strict";
        var wb = m.scry(this.getRoot(), '.fbPhotosPhotoActionsMenu')[0];
        if (wb)return;
        clearTimeout(this.fadePagerTimer);
        this.setStagePagersState('inactive');
    };
    vb.prototype.getTagger = function () {
        "use strict";
        return (this.PhotoTagger && this.PhotoTagger.getInstance(ea.VIEWER_SNOWLIFT));
    };
    vb.prototype.unhiliteAllTags = function () {
        "use strict";
        clearTimeout(this.unhiliteTimer);
        m.scry(this.stage, 'div.tagsWrapper div.hover').forEach(function (xb) {
            k.removeClass(xb, 'hover');
        });
        m.scry(this.stage, 'div.tagsWrapper div.otherActive').forEach(function (xb) {
            k.removeClass(xb, 'otherActive');
        });
        this.hilitedTag = null;
        this.showingTypeaheadSuggestions = false;
        if (!k.hasClass(this.root, 'taggingMode')) {
            var wb = this.getTagger();
            if (wb) {
                wb.hideTagger();
                wb.setCurrentFacebox(null);
            }
        }
    };
    vb.prototype.switchHilitedTags = function (wb, xb) {
        "use strict";
        if (this.switchTimer !== null) {
            clearTimeout(this.switchTimer);
            this.switchTimer = null;
        }
        this.unhiliteAllTags();
        this.hiliteAllBoxes();
        var yb = jb(wb);
        if (yb) {
            this.hilitedTag = wb;
            if (!k.hasClass(this.root, 'taggingMode') && la.isFacebox(this.hilitedTag)) {
                var zb = this.getTagger();
                if (zb) {
                    k.addClass(yb, 'hover');
                    var ac = zb.getFacebox(wb);
                    zb.setCurrentFacebox(ac);
                    if (ac)zb.addTagFromFacebox(ac);
                }
            } else k.addClass(yb, 'hover');
            if (k.hasClass(yb, 'tagBoxPending') && !k.hasClass(yb, 'showPendingTagName') && xb === true) {
                m.scry(this.stage, 'div.tagsWrapper div.showPendingTagName').forEach(function (bc) {
                    k.removeClass(bc, 'showPendingTagName');
                });
                k.addClass(yb, 'showPendingTagName');
            }
        }
    };
    vb.prototype.reHilitePendingTag = function () {
        "use strict";
        var wb = jb(this.hilitedTag);
        if (wb && k.hasClass(wb, 'showPendingTagName'))return;
        var xb = m.scry(this.stage, 'div.tagsWrapper div.showPendingTagName')[0];
        if (xb)this.switchHilitedTags(xb.id);
    };
    vb.prototype.hiliteTagsOnMouseMove = function (event) {
        "use strict";
        if (!this.stream.getCurrentExtraData() || this.getVideoOnStage())return;
        if (this.switchTimer !== null)return;
        var wb = event.getTarget();
        if (ba.byClass(wb, 'snowliftOverlay') || ba.byClass(wb, 'fbPhotoSnowliftTagApproval') || ba.byClass(wb, 'tagPointer') || ba.byClass(wb, 'arrow') || ba.byClass(wb, 'faceboxSuggestion') || ba.byClass(wb, 'typeaheadWrapper') || ba.byClass(wb, 'photoTagTypeahead'))return;
        var xb = ba.byClass(wb, 'tagBoxPending'), yb = false;
        if (this.hilitedTag) {
            var zb = jb(this.hilitedTag);
            yb = zb && k.hasClass(zb, 'tagBoxPending');
        }
        var ac = ((!this.hilitedTag && xb) || (!yb && xb));
        if (ac) {
            this.switchHilitedTags(xb.id);
            return;
        }
        if (xb && (xb.id == this.hilitedTag))return;
        var bc = 250, cc = 15, dc = za.getEventPosition(event);
        if (!this.startingMousePos)this.startingMousePos = dc;
        var ec = la.absoluteToNormalizedPosition(this.image, dc);
        if (!this.haveLeftBufferRegion && this.startingMousePos.distanceTo(dc) < cc) {
            return;
        } else this.haveLeftBufferRegion = true;
        if (this.currentTagHasPrecedence(ec))return;
        var fc = la.getNearestBox(this.stream.getCurrentExtraData().tagRects, ec);
        if (!fc) {
            if (!yb) {
                this.unhiliteAllTags();
                this.reHilitePendingTag();
            }
            return;
        }
        var gc = null;
        if (yb) {
            var hc = {};
            hc[this.hilitedTag] = this.stream.getCurrentExtraData().tagRects[this.hilitedTag];
            gc = la.getNearestBox(hc, ec);
        }
        if (gc !== null && yb)return;
        if (this.hilitedTag != fc)if (yb) {
            this.switchTimer = setTimeout(this.switchHilitedTags.bind(this, fc), bc);
        } else {
            if (this._showHover && !this._seenTags[fc]) {
                this._seenTags[fc] = true;
                ma.logPivotImpression('snowlift', fc);
            }
            this.switchHilitedTags(fc);
        }
    };
    vb.prototype.currentTagHasPrecedence = function (wb) {
        "use strict";
        if (!this.hilitedTag)return false;
        if (this.stream.getCurrentExtraData().tagRects[this.hilitedTag] === undefined) {
            this.hilitedTag = null;
            return false;
        }
        var xb = this.stream.getCurrentExtraData().tagRects[this.hilitedTag], yb = new pa(xb.t + (xb.h() / 2), xb.r, xb.b + (la.isFacebox(this.hilitedTag) ? 10 : 0), xb.l, xb.domain);
        return yb.contains(wb);
    };
    vb.prototype.getVideoOnStage = function () {
        "use strict";
        var wb = this.stream && this.stream.getCurrentImageData();
        return wb && wb.video;
    };
    vb.prototype.shouldPageOnAction = function (wb, xb) {
        "use strict";
        if (!this.isOpen || w.isShowingConfirmation())return false;
        var yb = m.isNode(xb) && (ba.byClass(xb, 'snowliftPager') || ba.byClass(xb, 'stagePagers') || ba.byClass(xb, 'pivotPageColumn')), zb = m.isNode(xb) && ba.byClass(xb, 'stage'), ac = k.hasClass(xb, 'faceBox'), bc = (!k.hasClass(this.root, 'taggingMode') && ac && !yb);
        if (bc) {
            if (!this.showingTypeaheadSuggestions) {
                this.getTagger().updateWithSuggestions();
                setTimeout((function () {
                    m.find(this.getTagger().tagger, 'input.textInput').focus();
                }).bind(this), 0);
            }
            this.showingTypeaheadSuggestions = !this.showingTypeaheadSuggestions;
            return false;
        }
        var cc = ((zb && k.hasClass(this.root, 'taggingMode')) || ba.byClass(xb, 'tagBoxPending') || ba.byClass(xb, 'tagBoxPendingResponse') || ba.byClass(xb, 'fbPhotoTagApprovalBox') || ba.byClass(xb, 'tag') || (this.cropper && this.cropper.croppingMode));
        if (cc)return false;
        if (zb && this._isZoomOn)return false;
        return wb == t.LEFT || wb == t.RIGHT || wb == ob || wb == pb || yb || bc || zb;
    };
    vb.prototype.keyHandler = function (wb, event) {
        "use strict";
        if (event.getModifiers().any || u.getTopmostLayer() !== this.spotlight)return true;
        switch (o.getKeyCode(event)) {
            case t.LEFT:
            case t.RIGHT:
            case ob:
            case pb:
                this.pageListener(event);
                return false;
            case qb:
                return this.toggleFullScreen();
            case rb:
                return this.likePhotoWithKey();
            case t.SPACE:
                this.toggleSlideshow();
                this.showPagers(vb.PAGER_FADE);
                return false;
            case t.ESC:
                if (this._isZoomOn) {
                    this._setZoomOut();
                    this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));
                    return false;
                }
                break;
        }
    };
    vb.prototype.shouldHandlePendingTag = function (event) {
        "use strict";
        var wb = this.getTagger();
        if (!wb || !wb.tags.length)return false;
        var xb = la.absoluteToNormalizedPosition(this.getImage(), za.getEventPosition(event)), yb = wb.findNearestTag(xb);
        if (!yb || !k.hasClass(yb.node, 'tagBoxPending'))return false;
        g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK', {id: yb.id, version: this.getVersionConst()});
        return true;
    };
    vb.prototype.pageListener = function (event) {
        "use strict";
        var wb = o.getKeyCode(event), xb = event.getTarget();
        if (this._slideshowToken) {
            this.stopSlideshow();
            return;
        }
        if (!this.shouldPageOnAction(wb, xb))return;
        if (this.shouldHandlePendingTag(event))return;
        var yb = 0;
        if (wb == t.RIGHT || wb == pb) {
            yb = 1;
            fa.setPagingAction('key_right');
            this._disableMouseOver = true;
        } else if (wb == t.LEFT || wb == ob) {
            yb = -1;
            fa.setPagingAction('key_left');
            this._disableMouseOver = true;
        } else if (ba.byClass(xb, 'next')) {
            yb = 1;
            fa.setPagingAction('click_next');
        } else if (ba.byClass(xb, 'prev')) {
            yb = -1;
            fa.setPagingAction('click_prev');
        } else if (!this.stagePagerPrev) {
            yb = 1;
            fa.setPagingAction('click_stage');
        } else {
            yb = -1;
            fa.setPagingAction('click_stage_back');
        }
        var zb = m.scry(this.ufiForm, 'input.mentionsHidden'), ac = false;
        for (var bc = 0; bc < zb.length; bc++)if (!s.isEmpty(zb[bc])) {
            ac = true;
            break;
        }
        if (ac || k.hasClass(this.root, 'fbPhotoSnowliftEditMode') || (this.cropper && this.cropper.croppingMode)) {
            this.warnLeavePage(this.page.bind(this, yb));
        } else {
            this.page(yb, ya.chrome() && q.isFullScreen());
            nb('snowlift', xb, event).uai(fa.pagingAction);
        }
    };
    vb.prototype.warnLeavePage = function (wb) {
        "use strict";
        new l().setTitle("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u044d\u0442\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443?").setBody("\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b, \u0435\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043a\u0438\u043d\u0435\u0442\u0435 \u044d\u0442\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443.").setButtons([
            {name: 'leave_page', label: "\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443", handler: wb},
            {name: 'continue_editing', label: "\u041e\u0441\u0442\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", className: 'inputaux'}
        ]).setModal(true).show();
    };
    vb.prototype.getUsesOpaqueCursor = function () {
        "use strict";
        return this.stream.getUsesOpaqueCursor();
    };
    vb.prototype.getOpaqueCursor = function (wb) {
        "use strict";
        return this.stream.getOpaqueCursor(wb);
    };
    vb.prototype.setReachedLeftEnd = function () {
        "use strict";
        this.stream.setReachedLeftEnd();
    };
    vb.prototype.setReachedRightEnd = function () {
        "use strict";
        this.stream.setReachedRightEnd();
    };
    vb.prototype.page = function (wb, xb) {
        "use strict";
        if (!this.stream.isValidMovement(wb) || !this.stream.nonCircularPhotoSetCanPage(wb)) {
            this.showPagers(vb.PAGER_FADE);
            return;
        }
        var yb = this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));
        if (this.snowflake && ((this.stream.getCursor() == this.firstInSet && wb < 0) || (this.firstInSet == yb && wb > 0))) {
            this.showPagers(vb.PAGER_FADE);
            return;
        }
        this.lastPage = Date.now();
        this.unhiliteAllTags();
        this.startingMousePos = null;
        this.haveLeftBufferRegion = false;
        this._seenTags = {};
        this._navCount += wb;
        var zb = this.stream.allLoaded ? Math.abs(this._navCount) - this.stream.getLength() : null;
        if (this._extraSlidePivot && this._albumFBID) {
            if (zb === -1) {
                ia.fetch(this._albumFBID, this.stream);
            } else if (zb === 0) {
                this.onExtraSlide = true;
                this.showPivotSlide(this._albumFBID, wb, xb);
                return;
            }
            if (this.onExtraSlide && zb !== 0) {
                this.onExtraSlide = false;
                this.hidePivotSlide();
                if (zb > 0) {
                    this._navCount = 0;
                } else return;
            }
        }
        var ac = this.getVideoOnStage();
        if (ac)this.switchVideo(ac, null, false);
        if (this.pivots && this.pivots.page(wb))return;
        g.inform('PhotoSnowlift.PAGE');
        ta.hide();
        this.recacheData();
        this.stream.moveCursor(wb);
        k.hide(this.image);
        if (wb !== 0) {
            this.storyID = null;
            this._updateContainerOwnerID();
        }
        if (this._isZoomOn)this._setZoomOut();
        if (this.stream.errorInCurrent()) {
            this.setLoadingState(vb.STATE_HTML, true);
            k.show(this.errorBox);
            return;
        }
        this.movementDelta += wb;
        var bc = this.stream.getCurrentImageData();
        if (bc) {
            var cc = this.getImageURL(bc);
            if (cc) {
                this.switchImage(cc, null, true);
            } else if (bc.video)this.switchVideo(bc.video, bc.info, true);
            if (!xb) {
                this.replaceUrl = true;
                lb(bc.info.permalink);
            }
            this.setLoadingState(vb.STATE_IMAGE_DATA, false);
        } else {
            this.setLoadingState(vb.STATE_IMAGE_PIXELS, true);
            this.setLoadingState(vb.STATE_IMAGE_DATA, true);
        }
        if (this.stream.getCurrentHtml()) {
            this.swapData();
        } else this.setLoadingState(vb.STATE_HTML, true);
        this.disableAds = !this.isLoggedInViewer || this.stream.isInViewAsMode();
        this.loadAds();
        if (this.cropper)this.cropper.resetPhoto();
        this.setLeftAndRightPagersState();
        if (this._slideshowToken) {
            k.addClass(this.root, 'slideshowStarted');
        } else if (this.slideshowAvailable)k.addClass(this.root, 'slideshowAvailable');
        if (!this._extraSlidePivot && this._showMorePhotos && this._albumFBID)if (zb === -1) {
            ia.fetch(this._albumFBID, this.stream);
        } else if (zb === 0) {
            ma.logSuggestMorePhotos();
            this.showMorePhotos(this._albumFBID, true);
            this.showPagers();
            this._navCount = 0;
        } else {
            this.hideMorePhotos();
            this.hidePagers();
        }
    };
    vb.prototype.showMorePhotos = function (wb, xb) {
        "use strict";
        if (this._showingMorePhotos)return;
        this._showingMorePhotos = true;
        if (!this.searchPivot)this.searchPivot = this.overlay.appendChild(document.createElement('div'));
        k.addClass(this.stageWrapper, "_5ymv");
        this.searchPivotComponent = oa.renderComponent(oa.createElement(ha, {className: "_27g", fbid: wb, onclose: this.hideMorePhotos.bind(this), endofalbum: xb || false, withBackground: true}), this.searchPivot);
    };
    vb.prototype.hideMorePhotos = function () {
        "use strict";
        if (this.searchPivotComponent && this._showingMorePhotos) {
            this._showingMorePhotos = false;
            k.removeClass(this.stageWrapper, "_5ymv");
            this.searchPivotComponent.setProps({fbid: null});
        }
    };
    vb.prototype.showPivotSlide = function (wb, xb, yb) {
        "use strict";
        if (this._showingPivotSlide)return;
        this._showingPivotSlide = true;
        if (!this.pivotSlide) {
            this.pivotSlide = m.create('div');
            m.insertBefore(this.stageActions, this.pivotSlide);
        }
        var zb = xb > 0 ? 1 : -1;
        this.pivotSlideComponent = oa.renderComponent(oa.createElement(ga, {fbid: wb, visible: true, onReturn: this.page.bind(this, zb, yb)}), this.pivotSlide);
    };
    vb.prototype.hidePivotSlide = function () {
        "use strict";
        if (this.pivotSlideComponent && this._showingPivotSlide)this.pivotSlideComponent.setProps({visible: false});
        this._showingPivotSlide = false;
    };
    vb.prototype.logImpressionDetailsForPhoto = function () {
        "use strict";
        var wb = [].concat(m.scry(cb('fbPhotoSnowliftTagList'), 'input.photoImpressionDetails'), m.scry(cb('fbPhotoSnowliftFeedback'), 'input.photoImpressionDetails'));
        if (wb.length === 0)return;
        var xb = {};
        for (var yb = 0; yb < wb.length; yb++)xb[wb[yb].name] = wb[yb].value;
        if (this.getVideoOnStage()) {
            xb.width = 0;
            xb.height = 0;
        } else {
            var zb = this.getImageDimensions(this.stream.getCurrentImageData());
            xb.width = zb.x;
            xb.height = zb.y;
        }
        fa.addDetailData(this.stream.getCursor(), xb);
        ja.setIsLogAdData(true);
    };
    vb.prototype.loadAds = function () {
        "use strict";
        if (this.disableAds)return;
        ja.loadAdsFromUserActivity();
    };
    vb.prototype.transitionHandler = function (wb) {
        "use strict";
        if (wb.getQueryData().closeTheater || wb.getQueryData().permPage || wb.getQueryData().makeprofile || this.returningToStart) {
            if (this.isOpen)this.close();
            this.transitionHandlerRegistered = false;
            return false;
        }
        if (this.replaceUrl) {
            this.replaceUrl = false;
            this._uriStack.push(wb.getQualifiedURI().toString());
            aa.transitionComplete(true);
            return true;
        }
        var xb = this._uriStack.length;
        if (xb >= 2 && this._uriStack[xb - 2] == wb.getQualifiedURI().toString())this._uriStack.pop();
        var yb = this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());
        if (yb) {
            var zb = this.stream.getRelativeMovement(yb);
            this.page(zb, true);
            aa.transitionComplete(false);
            return true;
        }
        if (this.isOpen) {
            aa.transitionComplete(true);
            this.close();
            return true;
        }
        this.transitionHandlerRegistered = false;
        return false;
    };
    vb.prototype.recacheData = function () {
        "use strict";
        if (!this.loadingStates.html) {
            var wb = this.stream.getCurrentHtml();
            for (var xb in wb) {
                wb[xb] = fb(cb(xb).childNodes);
                m.empty(cb(xb));
            }
        }
    };
    vb.prototype.reloadIfTimeout = function () {
        "use strict";
        if (!r.hasLoaded(this.image)) {
            var wb = this.makeNewImage(this.image.src, true);
            o.listen(wb, 'load', this.useImage.bind(this, wb, null, true));
            this._log(wb.src);
        }
    };
    vb.prototype.useImage = function (wb, xb, yb) {
        "use strict";
        if (yb && r.hasLoaded(this.image))return;
        m.replace(this.image, wb);
        this.image = wb;
        this.adjustStageSize(xb);
    };
    vb.prototype.makeNewImage = function (wb, xb) {
        "use strict";
        if (this.imageLoadingTimer) {
            clearTimeout(this.imageLoadingTimer);
            this.imageLoadingTimer = null;
        } else if (!xb)this.imageRefreshTimer = setTimeout(this.reloadIfTimeout.bind(this), vb.LOADING_TIMEOUT);
        var yb = m.create('img', {className: 'spotlight', alt: ''});
        yb.setAttribute('aria-describedby', 'fbPhotosSnowliftCaption');
        yb.setAttribute('aria-busy', 'true');
        var zb = function () {
            clearTimeout(this.imageRefreshTimer);
            this.image.setAttribute('aria-busy', 'false');
            this.setLoadingState(this.STATE_IMAGE_PIXELS, false);
            setTimeout((function () {
                if (this.isOpen) {
                    this.adjustStageSize();
                    this.adjustForNewData();
                }
            }).bind(this), 0);
        }.bind(this);
        o.listen(yb, 'load', zb);
        this._log(wb);
        yb.src = wb;
        return yb;
    };
    vb.prototype.switchImage = function (wb, xb, yb) {
        "use strict";
        k.hide(this.image);
        k.hide(this.errorBox);
        this.setLoadingState(this.STATE_IMAGE_PIXELS, true);
        var zb = this.stream && this.stream.getCurrentImageData();
        if (zb) {
            fa.addPhotoView(zb.info, this.shouldShowHiRes(zb), this.fullscreen && q.isFullScreen());
            if (this._showHover) {
                var ac = this.stream.getCurrentExtraData();
                if (ac)ma.logImageImpression('snowlift', String(this.stream.getCursor()), Object.keys(ac.tagRects));
            }
        }
        this.useImage(this.makeNewImage(wb, false), xb, false);
        if (yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));
        if (this.cropper && this.cropper.croppingMode)this.cropper.resetPhoto();
        var bc = new za(this.stage.clientWidth, this.stage.clientHeight);
        if (zb && this._shouldShowZoomButton(bc, zb.originalDimensions)) {
            fa.addPanoramaImpression();
            this._displayZoomButton(bc);
        } else if (this._hasZoomCapability)k.hide(this.showZoomButton);
        g.inform('PhotoSnowlift.SWITCH_IMAGE');
    };
    vb.prototype._conditionDisplayZoomButton = function () {
        "use strict";
        if (!this._hasZoomCapability)return;
        var wb = this.stream && this.stream.getCurrentImageData(), xb = wb && wb.originalDimensions;
        if (!xb)return;
        var yb = new za(this.stage.clientWidth, this.stage.clientHeight);
        if (this._shouldShowZoomButton(yb, xb)) {
            this._displayZoomButton(yb);
        } else k.hide(this.showZoomButton);
    };
    vb.prototype._displayZoomButton = function (wb) {
        "use strict";
        var xb = parseInt(this.image.style.height, 10), yb = (wb.y - xb) / 2;
        if (yb >= vb.ZOOM_BUTTON_TOP_PAD + vb.ZOOM_BUTTON_BOT_PAD + vb.ZOOM_BUTTON_HEIGHT) {
            var zb = yb - vb.ZOOM_BUTTON_HEIGHT - vb.ZOOM_BUTTON_TOP_PAD;
            sa.set(this.showZoomButton, 'bottom', zb + 'px');
        } else sa.set(this.showZoomButton, 'bottom', '60px');
        k.show(this.showZoomButton);
    };
    vb.prototype._shouldShowZoomButton = function (wb, xb) {
        "use strict";
        if (!this._hasZoomCapability || !xb)return false;
        var yb = xb.x / xb.y, zb = Math.min(wb.y * yb, xb.x);
        if (!isNaN(yb) && yb > 2 && xb.y > vb.MIN_PANORAMA_Y && wb.x * vb.MIN_PANO_TO_STAGE_RATIO < zb) {
            return true;
        } else return false;
    };
    vb.prototype._setZoomIn = function () {
        "use strict";
        this._isZoomOn = true;
        k.hide(this.showZoomButton);
        k.show(this.zoomOutSwitch);
        k.hide(this.stageActions);
        sa.set(this.stage, 'overflow', 'hidden');
        this.spotlight.disableBehavior(v);
        this.collapseRHC();
    };
    vb.prototype._setZoomOut = function () {
        "use strict";
        if (!this._hasZoomCapability)return;
        this._isZoomOn = false;
        this.spotlight.enableBehavior(v);
        sa.set(this.stage, 'overflow', 'visible');
        k.hide(this.showZoomButton);
        k.hide(this.zoomedImage);
        k.hide(this.outerImageSlider);
        k.hide(this.zoomOutSwitch);
        k.show(this.stageActions);
        this.uncollapseRHC();
    };
    vb.prototype.switchIntoZoomedImage = function (wb) {
        "use strict";
        this._setZoomIn();
        k.hide(this.zoomedImage);
        k.hide(this.outerImageSlider);
        var xb = this.stream.getCurrentImageData(), yb = xb.originalDimensions;
        this.zoomedImage.src = xb.url;
        this.adjustStageSize(yb);
        this._initializeZoomedImagePositions(new za(parseInt(sa.get(this.zoomedImage, 'width'), 10), parseInt(sa.get(this.zoomedImage, 'height'), 10)));
        k.hide(this.image);
    };
    vb.prototype._adjustInnerImageSlider = function (wb) {
        "use strict";
        var xb = this.stage.clientWidth, yb = Math.min(100, (xb / wb.x) * 100);
        sa.set(this.innerImageSlider, 'width', yb + '%');
        return yb;
    };
    vb.prototype._getSliderSizeForZoomedImage = function (wb) {
        "use strict";
        var xb = vb.MAX_SLIDER_HEIGHT * this.stage.clientHeight / wb.y, yb = vb.MAX_SLIDER_WIDTH * this.stage.clientWidth / wb.x, zb = Math.min(xb, yb);
        return new za(100 * wb.x * zb / this.stage.clientWidth, 100 * wb.y * zb / this.stage.clientHeight);
    };
    vb.prototype._initializeZoomedImagePositions = function (wb) {
        "use strict";
        var xb = this.stage.clientWidth, yb = this._adjustInnerImageSlider(wb);
        sa.set(this.innerImageSlider, 'marginLeft', (50 - yb / 2) + '%');
        sa.set(this.zoomedImage, 'marginLeft', ((xb - wb.x) / 2) + 'px');
        var zb = this._getSliderSizeForZoomedImage(wb);
        sa.set(this.outerImageSlider, 'width', zb.x + '%');
        sa.set(this.outerImageSlider, 'height', zb.y + '%');
        sa.set(this.outerImageSlider, 'left', (50 - zb.x / 2) + '%');
        k.show(this.zoomedImage);
        k.show(this.outerImageSlider);
    };
    vb.prototype._zoomedImageMouseDown = function (event) {
        "use strict";
        if (!this._isZoomOn)return;
        k.addClass(this.stage, 'showSlider');
        if (this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();
        var wb = false, xb = event.getTarget();
        if (ba.byClass(xb, "_10zv")) {
            this.startSliderMargins = new za(parseFloat(sa.get(this.innerImageSlider, 'marginLeft')), parseFloat(sa.get(this.innerImageSlider, 'marginTop')));
            this.startImageMargins = null;
            this.mouseDownStartPosition = new za(event.clientX, event.clientY);
        } else if (ba.byClass(xb, "_10zx")) {
            this.startSliderMargins = new za(parseInt(sa.get(this.innerImageSlider, 'marginLeft'), 10), parseInt(sa.get(this.innerImageSlider, 'marginTop'), 10));
            this.startImageMargins = null;
            var yb = parseInt(sa.get(this.innerImageSlider, 'width'), 10);
            this.mouseDownStartPosition = new za(this.innerImageSlider.getBoundingClientRect().left + yb / 2, event.clientY);
            wb = true;
        } else if (ba.byClass(xb, "_10zw")) {
            this.startImageMargins = new za(parseInt(sa.get(this.zoomedImage, 'marginLeft'), 10), parseInt(sa.get(this.zoomedImage, 'marginTop'), 10));
            this.startSliderMargins = null;
            this.mouseDownStartPosition = new za(event.clientX, event.clientY);
        }
        this._zoomedImageMouseMoveHandle = o.listen(this.stage, 'mousemove', this._zoomedImagePan.bind(this));
        if (wb) {
            this._zoomedImagePan(event);
        } else event.kill();
    };
    vb.prototype._zoomedImageMouseUp = function (event) {
        "use strict";
        if (this._zoomedImageMouseMoveHandle) {
            k.removeClass(this.stage, 'showSlider');
            this._zoomedImageMouseMoveHandle.remove();
            this._zoomedImageMouseMoveHandle = null;
        }
    };
    vb.prototype._zoomedImagePan = function (event) {
        "use strict";
        var wb;
        if (this.startSliderMargins) {
            wb = event.clientX - this.mouseDownStartPosition.x;
            var xb = parseFloat(sa.get(this.outerImageSlider, 'width')), yb = parseFloat(sa.get(this.innerImageSlider, 'width')), zb = Math.max(0, Math.min(xb - yb, this.startSliderMargins.x + wb)) / xb;
            sa.set(this.innerImageSlider, 'marginLeft', 100 * zb + "%");
            sa.set(this.zoomedImage, 'marginLeft', -1 * zb * this.zoomedImage.width + 'px');
            event.kill();
        } else if (this.startImageMargins) {
            wb = 1.75 * (this.mouseDownStartPosition.x - event.clientX);
            var ac = Math.min(0, Math.max(this.startImageMargins.x - wb, -this.zoomedImage.width + this.stage.clientWidth));
            sa.set(this.zoomedImage, 'marginLeft', ac + 'px');
            sa.set(this.innerImageSlider, 'marginLeft', (-ac / this.zoomedImage.width * 100) + "%");
            event.kill();
        }
    };
    vb.prototype._repositionZoomedImageOnResize = function () {
        "use strict";
        var wb = Math.min(0, Math.max(parseInt(sa.get(this.zoomedImage, 'marginLeft'), 10), -this.zoomedImage.width + this.stage.clientWidth));
        sa.set(this.zoomedImage, 'marginLeft', wb + 'px');
        sa.set(this.innerImageSlider, 'marginLeft', (-wb / this.zoomedImage.width * 100) + "%");
        this._adjustInnerImageSlider(new za(this.zoomedImage.width, this.zoomedImage.height));
    };
    vb.prototype.switchVideo = function (wb, xb, yb) {
        "use strict";
        this._pauseVideoIfNeeded();
        var zb = 'swf_' + wb;
        m.empty(this.videoStage);
        if (yb) {
            k.addClass(this.stageWrapper, 'showVideo');
            var ac = this.stream.getCurrentImageData(), bc = null;
            if (ac.video_element) {
                bc = ac.video_element;
                bc.style.cssText = '';
                bc.firstChild.style.cssText = '';
            } else {
                bc = m.create('div');
                bc.setAttribute('data-flash', true);
                bc.id = wb;
            }
            k.addClass(bc, 'videoStageContainer');
            m.appendContent(this.videoStage, bc);
            if (ac.ctaendscreen)m.appendContent(this.videoStage, ac.ctaendscreen);
            if (window[zb] && !jb(zb))window[zb].write(wb);
            var cc = 'video_warning_' + wb, dc = jb(wb);
            if (!this.videoWarnings)this.videoWarnings = [];
            if (dc && this.videoWarnings[cc])m.setContent(dc, this.videoWarnings[cc]);
            if (!ac.controller) {
                var ec = xb ? xb.fbid.toString() : null, fc = {root_element: dc ? dc.parentNode : null, video_element: dc, cta_endscreen: ac.ctaendscreen};
                this._videoPlayerStateManager = new ab({player_version: xb ? xb.playerversion : 'casablanca', source: 'snowlift', video_id: ec}, fc);
            } else {
                this._videoPlayerStateManager = ac.controller;
                this._videoPlayerStateManager.reset();
            }
            if (this._autoplayVideos)this._videoPlayerStateManager.play(bb.USER);
            setTimeout(this.adjustStageSizeForVideo.bind(this, zb), 0);
        } else {
            window[zb] && window[zb].addVariable('video_autoplay', 0);
            this.videoLoadTimer && clearTimeout(this.videoLoadTimer);
            k.removeClass(this.stageWrapper, 'showVideo');
        }
    };
    vb.prototype.checkVideoStatus = function (wb) {
        "use strict";
        if (this.videoLoadTimer)clearTimeout(this.videoLoadTimer);
        var xb = this.getVideoOnStage();
        if (!xb) {
            return;
        } else {
            var yb = 'swf_' + xb;
            if (wb !== yb)return;
            this.adjustStageSizeForVideo(wb);
        }
    };
    vb.prototype.adjustStageSizeForVideo = function (wb) {
        "use strict";
        var xb = jb(wb);
        if (!xb) {
            this.videoLoadTimer = setTimeout(this.checkVideoStatus.bind(this, wb), 200);
        } else this.adjustStageSize(new za(xb.width, xb.height));
    };
    vb.prototype.handleServerError = function (wb, xb) {
        "use strict";
        m.setContent(this.errorBox, wb);
        this.storeFromData(xb);
    };
    vb.prototype.fixButtonText = function (wb) {
        "use strict";
        if (!this.buttonTruncateGk)return;
        var xb = m.scry(wb, ".photosTruncatingUIButton"), yb = parseInt(sa.get(wb, 'width'), 10);
        if (yb > sb) {
            var zb = {tagPhoto: "\u041e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u043d\u0430 \u0444\u043e\u0442\u043e", doneTagPhoto: "\u0417\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0435\u0442\u043a\u0438", addLocation: "\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0435\u0441\u0442\u043e \u0443\u0447\u0435\u0431\u044b", editPhoto: "\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"};
            for (var ac = 0; ac < xb.length; ac++) {
                var bc = xb[ac];
                k.addClass(bc, "_2n0k");
                ua.set(bc, zb[bc.getAttribute('data-buttonname')], 'below', 'center');
            }
        }
    };
    vb.prototype.swapData = function () {
        "use strict";
        var wb, xb = this.stream.getCurrentHtml();
        if (xb) {
            this.setLoadingState(vb.STATE_HTML, false);
            for (var yb in xb) {
                wb = jb(yb);
                wb && m.setContent(wb, xb[yb]);
            }
            var zb = jb('photosTruncatingUIButtonGroup');
            zb && this.fixButtonText(zb);
            g.inform('PhotoSnowlift.DATA_CHANGE', eb(this.stream.getCurrentImageData().info, {movement: this.movementDelta}), g.BEHAVIOR_STATE);
            this.movementDelta = 0;
            if (this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE', this.stream.getCurrentExtraData(), g.BEHAVIOR_STATE);
        }
        this.adjustScroller();
        this.scrollableArea.showScrollbar(false);
        this.adjustForNewData();
        this.logImpressionDetailsForPhoto();
    };
    vb.prototype.updateTotalCount = function (wb, xb, yb) {
        "use strict";
        var zb = this.stream.getCurrentHtml();
        if (zb) {
            var ac = cb('fbPhotoSnowliftPositionAndCount');
            m.replace(ac, yb);
            ac = yb;
            k.show(ac);
            var bc = 'fbPhotoSnowliftPositionAndCount';
            zb[bc] = fb(ac.childNodes);
        }
        this.stream.setTotalCount(wb);
        this.stream.setFirstCursorIndex(xb);
    };
    vb.prototype.addPhotoFbids = function (wb, xb, yb, zb) {
        "use strict";
        if (zb && this.sessionID && zb != this.sessionID)return;
        var ac = this.stream.getCursor() === null;
        this.stream.attachToFbidsList(wb, xb, yb);
        if (yb && ac)this.page(0, true);
        if (this.pivots && yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(), this.stream.firstCursor));
        if (!this.pagersShown && this.stream.canPage())this.setStagePagersState('ready');
        if (!this.slideshowAvailable && this.stream.canPage()) {
            this.slideshowAvailable = true;
            k.addClass(this.root, 'slideshowAvailable');
        }
        this.setLeftAndRightPagersState();
    };
    vb.prototype.attachTagger = function (wb) {
        "use strict";
        m.appendContent(this.stageActions, wb);
    };
    vb.prototype.storeFromData = function (wb) {
        "use strict";
        if (!this.isOpen)return;
        if (wb.ssid && this.sessionID && this.sessionID != wb.ssid)return;
        var xb = this.stream.storeToCache(wb);
        if ('error' in xb) {
            this.checkState(vb.STATE_ERROR);
            return;
        }
        if ('init' in wb) {
            this._albumFBID = wb.init.album_fbid;
            this._autoplayVideos = wb.init.autoplay_videos;
        }
        if ('init' in xb) {
            this.initDataFetched(xb.init);
            if (this.openExplicitly) {
                this.replaceUrl = true;
                lb(this.stream.getCurrentImageData().info.permalink);
            }
            if (this.stream.canPage())this.setStagePagersState('ready');
            this.setLeftAndRightPagersState();
            this.ua && this.ua.add_event('ufi');
        }
        if ('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);
        if ('data' in xb)this.checkState(vb.STATE_HTML);
    };
    vb.prototype.setLeftAndRightPagersState = function () {
        "use strict";
        if (this.stream.isNonCircularPhotoSet()) {
            k.conditionClass(this.root, 'disableLeft', !this.stream.nonCircularPhotoSetCanPage(-1));
            k.conditionClass(this.root, 'disableRight', !this.stream.nonCircularPhotoSetCanPage(1));
        }
        if (this.snowflake) {
            k.conditionClass(this.root, 'disableLeft', this.stream.getCursor() == this.firstInSet);
            var wb = this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));
            k.conditionClass(this.root, 'disableRight', wb == this.firstInSet);
        }
    };
    vb.prototype.setStagePagersState = function (wb) {
        "use strict";
        switch (wb) {
            case 'ready':
                k.addClass(this.root, 'pagingReady');
                this.pagersShown = true;
                this.ua && this.ua.add_event('arrows');
                return;
            case 'active':
                k.addClass(this.root, 'pagingActivated');
                return;
            case 'inactive':
                k.removeClass(this.root, 'pagingActivated');
                return;
            case 'disabled':
            case 'reset':
                k.removeClass(this.root, 'pagingReady');
                return;
        }
    };
    vb.prototype.deletePhoto = function (wb) {
        "use strict";
        this.closeRefresh();
    };
    vb.prototype.closeRefresh = function () {
        "use strict";
        this.refreshOnClose = true;
        this.spotlight.hide();
    };
    vb.prototype.onHiliteTag = function (wb, xb) {
        "use strict";
        if (xb.version != ea.VIEWER_SNOWLIFT)return;
        var yb = xb.tag;
        if (yb)this.switchHilitedTags(yb, true);
    };
    vb.prototype.onUpdateTagBox = function (wb, xb) {
        "use strict";
        if (xb.version == ea.VIEWER_SNOWLIFT)this.updateTagBox(xb.id, xb.approve);
    };
    vb.prototype._log = function (wb) {
        "use strict";
        if (this._shouldLog) {
            this._logger && this._logger.log(wb);
            return true;
        }
        return false;
    };
    vb.prototype._enableMouseOver = function () {
        "use strict";
        this._disableMouseOver = false;
    };
    vb.prototype._interceptMouseOver = function (event) {
        "use strict";
        if (this._disableMouseOver)event.kill();
    };
    vb.prototype.isReturningToStart = function () {
        "use strict";
        return !!this.returningToStart;
    };
    vb.prototype._pauseVideoIfNeeded = function () {
        "use strict";
        if (this._videoPlayerStateManager)this._videoPlayerStateManager.logStopForUnload();
    };
    vb.getInstance = function () {
        "use strict";
        if (!vb._instance)vb._instance = new vb();
        return vb._instance;
    };
    vb.initWithSpotlight = function (wb, xb) {
        "use strict";
        vb.getInstance().init(wb, xb);
    };
    vb.addPhotoFbids = function (wb, xb, yb, zb) {
        "use strict";
        vb.getInstance().addPhotoFbids(wb, xb, yb, zb);
    };
    vb.setReachedLeftEnd = function () {
        "use strict";
        vb.getInstance().setReachedLeftEnd();
    };
    vb.setReachedRightEnd = function () {
        "use strict";
        vb.getInstance().setReachedRightEnd();
    };
    vb.attachFollowFlyout = function (wb) {
        "use strict";
        m.insertAfter(cb('fbPhotoSnowliftSubscribe'), wb);
    };
    vb.attachSubscribeFlyout = function (wb) {
        "use strict";
        m.insertAfter(cb('fbPhotoSnowliftSubscribe'), wb);
    };
    vb.attachTagger = function (wb) {
        "use strict";
        vb.getInstance().attachTagger(wb);
    };
    vb.preload = function (wb, xb) {
        "use strict";
        vb.getInstance().preload(wb, xb);
    };
    vb.bootstrap = function (wb, xb) {
        "use strict";
        var yb = wb && xa(wb).getQueryData();
        if (yb && yb.hasOwnProperty('share_id')) {
            j.loadModules(["SpotlightShareViewer"], function (zb) {
                zb.bootstrap(wb, xb);
            });
            return;
        }
        vb.getInstance().bootstrap(wb, xb);
    };
    vb.closeRefresh = function () {
        "use strict";
        vb.getInstance().closeRefresh();
    };
    vb.deletePhoto = function (wb) {
        "use strict";
        vb.getInstance().deletePhoto(wb);
    };
    vb.getImage = function () {
        "use strict";
        return vb.getInstance().getImage();
    };
    vb.getImageId = function () {
        "use strict";
        return vb.getInstance().getImageId();
    };
    vb.getLoadQuery = function () {
        "use strict";
        return vb.getInstance().getLoadQuery();
    };
    vb.getRHCBody = function () {
        "use strict";
        return vb.getInstance().getRHCBody();
    };
    vb.getRHCFooter = function () {
        "use strict";
        return vb.getInstance().getRHCFooter();
    };
    vb.getRHCHeader = function () {
        "use strict";
        return vb.getInstance().getRHCHeader();
    };
    vb.getRoot = function () {
        "use strict";
        return vb.getInstance().getRoot();
    };
    vb.likePhotoSkipConfirmation = function (wb) {
        "use strict";
        vb.getInstance().likePhotoSkipConfirmation(wb);
    };
    vb.saveTagsFromPayload = function (wb) {
        "use strict";
        vb.getInstance().saveTagsFromPayload(wb);
    };
    vb.saveTagsFromPayloadDelayed = function (wb) {
        "use strict";
        setTimeout(vb.saveTagsFromPayload.bind(null, wb), 2000);
    };
    vb.handleServerError = function (wb, xb) {
        "use strict";
        vb.getInstance().handleServerError(wb, xb);
    };
    vb.setVideoWarning = function (wb, xb) {
        "use strict";
        var yb = vb.getInstance(), zb = 'video_warning_' + wb;
        if (!yb.videoWarnings)yb.videoWarnings = [];
        yb.videoWarnings[zb] = xb;
    };
    vb.storeFromData = function (wb) {
        "use strict";
        vb.getInstance().storeFromData(wb);
    };
    vb.swapData = function () {
        "use strict";
        vb.getInstance().swapData();
    };
    vb.updateTotalCount = function (wb, xb, yb) {
        "use strict";
        vb.getInstance().updateTotalCount(wb, xb, yb);
    };
    vb.setVideoRotateURI = function (wb) {
        "use strict";
        vb.getInstance().videoRotateURI = wb;
    };
    eb(vb, {STATE_ERROR: 'error', STATE_HTML: 'html', STATE_IMAGE_PIXELS: 'image_pixels', STATE_IMAGE_DATA: 'image', LOADING_TIMEOUT: 2000, PAGER_FADE: 3000, FULL_SCREEN_PADDING: 10, STAGE_NORMAL_MAX: {x: 960, y: 960}, STAGE_MIN: {x: 520, y: 520}, SIDEBAR_SIZE_MAX: 360, MIN_PANORAMA_Y: 240, ZOOM_BUTTON_HEIGHT: 52, ZOOM_BUTTON_BOT_PAD: 60, ZOOM_BUTTON_TOP_PAD: 16, MAX_SLIDER_HEIGHT: .075, MAX_SLIDER_WIDTH: .75, MIN_PANO_TO_STAGE_RATIO: 1.2, STAGE_CHROME: {x: 82, y: 42}, VIDEO_BOTTOM_BAR_SPACE: 40, GOPREV_AREA: 120, TIMELINE_STRETCH_WIDTH: 843, TIMELINE_STRETCH_MIN: 480, MIN_TAG_DISTANCE: 83, PADDING_MIN: 40, MIN_UFI_HEIGHT: 250, COLLECTIONS_UNTAGGED_PHOTOS: 3, PHOTOS_OF_YOU_SUGGESTIONS: 28, FRIENDS_IN_PHOTOS_SUGGESTIONS: 31, MIN_ADS_VISIBLE: 1, PINNED_UFI_ADJUSTMENT: 11, ADD_COMMENT_HEIGHT: 54, SLIDESHOW_TIME: 3000, _instance: null, touch: ib, touchMarkup: ib});
    eb(vb.prototype, {switchTimer: null, imageRefreshTimer: null, imageLoadingTimer: null, lastPage: 0, currentMinSize: null, currentImageSize: null, resetUriStack: true, thumbSrc: null, shouldStretch: false, stageMax: vb.STAGE_NORMAL_MAX, stageChrome: vb.STAGE_CHROME, stagePagerPrev: null, ua: null, PhotoTagger: null});
    e.exports = vb;
}, null);
__d("Spotlight", ["Arbiter", "ArbiterMixin", "DOM", "JSXDOM", "Layer", "LayerAutoFocus", "LayerTabIsolation", "ModalLayer", "Vector", "classWithMixins", "copyProperties", "csx", "cx", "joinClasses", "mixin"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u) {
    var v = p(k, u(h));
    for (var w in v)if (v.hasOwnProperty(w))y[w] = v[w];
    var x = v === null ? null : v.prototype;
    y.prototype = Object.create(x);
    y.prototype.constructor = y;
    y.__superConstructor__ = v;
    function y(aa, ba) {
        "use strict";
        v.call(this, aa, ba);
        this.stageMinSize = new o(0, 0);
        this.stagePadding = new o(0, 0);
    }

    y.prototype._buildWrapper = function (aa, ba) {
        "use strict";
        var ca = t("_n8 _3qx", aa.rootClassName);
        return (j.div({className: ca}, j.div({className: "_n9"}, ba)));
    };
    y.prototype._getDefaultBehaviors = function () {
        "use strict";
        return x._getDefaultBehaviors.call(this).concat([z, l, m, n]);
    };
    y.prototype.getContentRoot = function () {
        "use strict";
        if (!this._content)this._content = i.find(this.getRoot(), "div._n3");
        return this._content;
    };
    y.prototype.configure = function (aa) {
        "use strict";
        if (aa.stageMinSize)this.stageMinSize = aa.stageMinSize;
        if (aa.stagePadding)this.stagePadding = aa.stagePadding;
    };
    y.prototype.onContentLoaded = function () {
        "use strict";
        this.inform('content-load');
    };
    y.prototype.updatePermalink = function (aa) {
        "use strict";
        this.inform('permalinkchange', aa);
    };
    q(y.prototype, {stageMinSize: null, stagePadding: null});
    function z(aa) {
        "use strict";
        this._layer = aa;
    }

    z.prototype.enable = function () {
        "use strict";
        this._subscription = this._layer.subscribe(['show', 'hide'], function (aa, ba) {
            if (aa === 'show') {
                g.inform('layer_shown', {type: 'Spotlight'});
            } else g.inform('layer_hidden', {type: 'Spotlight'});
        });
    };
    z.prototype.disable = function () {
        "use strict";
        this._subscription.unsubscribe();
        this._subscription = null;
    };
    q(z.prototype, {_subscription: null});
    e.exports = y;
}, null);